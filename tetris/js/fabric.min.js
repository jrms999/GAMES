/*! Fabric.js Copyright 2008-2011, Bitsonnet (Juriy Zaytsev, Maxim Chernyak) */
var fabric=fabric||{version:"0.2.5"};fabric.log=function(){};fabric.warn=function(){};if(typeof console!=="undefined"){if(typeof console.log!=="undefined"&&console.log.apply){fabric.log=function(){return console.log.apply(console,arguments)}}if(typeof console.warn!=="undefined"&&console.warn.apply){fabric.warn=function(){return console.warn.apply(console,arguments)}}}if(!this.JSON){this.JSON={}}(function(){function f(n){return n<10?"0"+n:n}if(typeof Date.prototype.toJSON!=="function"){Date.prototype.toJSON=function(key){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+f(this.getUTCMonth()+1)+"-"+f(this.getUTCDate())+"T"+f(this.getUTCHours())+":"+f(this.getUTCMinutes())+":"+f(this.getUTCSeconds())+"Z":null};String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(key){return this.valueOf()}}var cx=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,escapable=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,gap,indent,meta={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},rep;function quote(string){escapable.lastIndex=0;return escapable.test(string)?'"'+string.replace(escapable,function(a){var c=meta[a];return typeof c==="string"?c:"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+string+'"'}function str(key,holder){var i,k,v,length,mind=gap,partial,value=holder[key];if(value&&typeof value==="object"&&typeof value.toJSON==="function"){value=value.toJSON(key)}if(typeof rep==="function"){value=rep.call(holder,key,value)}switch(typeof value){case"string":return quote(value);case"number":return isFinite(value)?String(value):"null";case"boolean":case"null":return String(value);case"object":if(!value){return"null"}gap+=indent;partial=[];if(Object.prototype.toString.apply(value)==="[object Array]"){length=value.length;for(i=0;i<length;i+=1){partial[i]=str(i,value)||"null"}v=partial.length===0?"[]":gap?"[\n"+gap+partial.join(",\n"+gap)+"\n"+mind+"]":"["+partial.join(",")+"]";gap=mind;return v}if(rep&&typeof rep==="object"){length=rep.length;for(i=0;i<length;i+=1){k=rep[i];if(typeof k==="string"){v=str(k,value);if(v){partial.push(quote(k)+(gap?": ":":")+v)}}}}else{for(k in value){if(Object.hasOwnProperty.call(value,k)){v=str(k,value);if(v){partial.push(quote(k)+(gap?": ":":")+v)}}}}v=partial.length===0?"{}":gap?"{\n"+gap+partial.join(",\n"+gap)+"\n"+mind+"}":"{"+partial.join(",")+"}";gap=mind;return v}}if(typeof JSON.stringify!=="function"){JSON.stringify=function(value,replacer,space){var i;gap="";indent="";if(typeof space==="number"){for(i=0;i<space;i+=1){indent+=" "}}else{if(typeof space==="string"){indent=space}}rep=replacer;if(replacer&&typeof replacer!=="function"&&(typeof replacer!=="object"||typeof replacer.length!=="number")){throw new Error("JSON.stringify")}return str("",{"":value})}}if(typeof JSON.parse!=="function"){JSON.parse=function(text,reviver){var j;function walk(holder,key){var k,v,value=holder[key];if(value&&typeof value==="object"){for(k in value){if(Object.hasOwnProperty.call(value,k)){v=walk(value,k);if(v!==undefined){value[k]=v}else{delete value[k]}}}}return reviver.call(holder,key,value)}text=String(text);cx.lastIndex=0;if(cx.test(text)){text=text.replace(cx,function(a){return"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)})}if(/^[\],:{}\s]*$/.test(text.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,""))){j=eval("("+text+")");return typeof reviver==="function"?walk({"":j},""):j}throw new SyntaxError("JSON.parse")}}}());(function(){var a=document.defaultView;if(a&&a.getComputedStyle){var b=a.getComputedStyle(document.documentElement,"");if(b===null){a.getComputedStyle=function c(d,e){return d.style}}}})();
/*!
 * Copyright (c) 2009 Simo Kinnunen.
 * Licensed under the MIT license.
 */
var Cufon=(function(){var k=function(){return k.replace.apply(null,arguments)};var u=k.DOM={ready:(function(){var z=false,B={loaded:1,complete:1};var y=[],A=function(){if(z){return}z=true;for(var C;C=y.shift();C()){}};if(document.addEventListener){document.addEventListener("DOMContentLoaded",A,false);window.addEventListener("pageshow",A,false)}if(!window.opera&&document.readyState){(function(){B[document.readyState]?A():setTimeout(arguments.callee,10)})()}if(document.readyState&&document.createStyleSheet){(function(){try{document.body.doScroll("left");A()}catch(C){setTimeout(arguments.callee,1)}})()}o(window,"load",A);return function(C){if(!arguments.length){A()}else{z?C():y.push(C)}}})()};var l=k.CSS={Size:function(z,y){this.value=parseFloat(z);this.unit=String(z).match(/[a-z%]*$/)[0]||"px";this.convert=function(A){return A/y*this.value};this.convertFrom=function(A){return A/this.value*y};this.toString=function(){return this.value+this.unit}},getStyle:function(y){return new a(y.style)},quotedList:i(function(B){var A=[],z=/\s*((["'])([\s\S]*?[^\\])\2|[^,]+)\s*/g,y;while(y=z.exec(B)){A.push(y[3]||y[1])}return A}),ready:(function(){var A=false;var z=[],B=function(){A=true;for(var D;D=z.shift();D()){}};var y=Object.prototype.propertyIsEnumerable?f("style"):{length:0};var C=f("link");u.ready(function(){var G=0,F;for(var E=0,D=C.length;F=C[E],E<D;++E){if(!F.disabled&&F.rel.toLowerCase()=="stylesheet"){++G}}if(document.styleSheets.length>=y.length+G){B()}else{setTimeout(arguments.callee,10)}});return function(D){if(A){D()}else{z.push(D)}}})(),supports:function(A,z){var y=document.createElement("span").style;if(y[A]===undefined){return false}y[A]=z;return y[A]===z},textAlign:function(B,A,y,z){if(A.get("textAlign")=="right"){if(y>0){B=" "+B}}else{if(y<z-1){B+=" "}}return B},textDecoration:function(D,C){if(!C){C=this.getStyle(D)}var z={underline:null,overline:null,"line-through":null};for(var y=D;y.parentNode&&y.parentNode.nodeType==1;){var B=true;for(var A in z){if(z[A]){continue}if(C.get("textDecoration").indexOf(A)!=-1){z[A]=C.get("color")}B=false}if(B){break}C=this.getStyle(y=y.parentNode)}return z},textShadow:i(function(C){if(C=="none"){return null}var B=[],D={},y,z=0;var A=/(#[a-f0-9]+|[a-z]+\(.*?\)|[a-z]+)|(-?[\d.]+[a-z%]*)|,/ig;while(y=A.exec(C)){if(y[0]==","){B.push(D);D={},z=0}else{if(y[1]){D.color=y[1]}else{D[["offX","offY","blur"][z++]]=y[2]}}}B.push(D);return B}),color:i(function(z){var y={};y.color=z.replace(/^rgba\((.*?),\s*([\d.]+)\)/,function(B,A,C){y.opacity=parseFloat(C);return"rgb("+A+")"});return y}),textTransform:function(z,y){return z[{uppercase:"toUpperCase",lowercase:"toLowerCase"}[y.get("textTransform")]||"toString"]()}};function q(z){var y=this.face=z.face;this.glyphs=z.glyphs;this.w=z.w;this.baseSize=parseInt(y["units-per-em"],10);this.family=y["font-family"].toLowerCase();this.weight=y["font-weight"];this.style=y["font-style"]||"normal";this.viewBox=(function(){var B=y.bbox.split(/\s+/);var A={minX:parseInt(B[0],10),minY:parseInt(B[1],10),maxX:parseInt(B[2],10),maxY:parseInt(B[3],10)};A.width=A.maxX-A.minX,A.height=A.maxY-A.minY;A.toString=function(){return[this.minX,this.minY,this.width,this.height].join(" ")};return A})();this.ascent=-parseInt(y.ascent,10);this.descent=-parseInt(y.descent,10);this.height=-this.ascent+this.descent}function e(){var z={},y={oblique:"italic",italic:"oblique"};this.add=function(A){(z[A.style]||(z[A.style]={}))[A.weight]=A};this.get=function(E,F){var D=z[E]||z[y[E]]||z.normal||z.italic||z.oblique;if(!D){return null}F={normal:400,bold:700}[F]||parseInt(F,10);if(D[F]){return D[F]}var B={1:1,99:0}[F%100],H=[],C,A;if(B===undefined){B=F>400}if(F==500){F=400}for(var G in D){G=parseInt(G,10);if(!C||G<C){C=G}if(!A||G>A){A=G}H.push(G)}if(F<C){F=C}if(F>A){F=A}H.sort(function(J,I){return(B?(J>F&&I>F)?J<I:J>I:(J<F&&I<F)?J>I:J<I)?-1:1});return D[H[0]]}}function p(){function A(C,D){if(C.contains){return C.contains(D)}return C.compareDocumentPosition(D)&16}function y(D){var C=D.relatedTarget;if(!C||A(this,C)){return}z(this)}function B(C){z(this)}function z(C){setTimeout(function(){k.replace(C,d.get(C).options,true)},10)}this.attach=function(C){if(C.onmouseenter===undefined){o(C,"mouseover",y);o(C,"mouseout",y)}else{o(C,"mouseenter",B);o(C,"mouseleave",B)}}}function x(){var A={},y=0;function z(B){return B.cufid||(B.cufid=++y)}this.get=function(B){var C=z(B);return A[C]||(A[C]={})}}function a(y){var A={},z={};this.get=function(B){return A[B]!=undefined?A[B]:y[B]};this.getSize=function(C,B){return z[C]||(z[C]=new l.Size(this.get(C),B))};this.extend=function(B){for(var C in B){A[C]=B[C]}return this}}function o(z,y,A){if(z.addEventListener){z.addEventListener(y,A,false)}else{if(z.attachEvent){z.attachEvent("on"+y,function(){return A.call(z,window.event)})}}}function r(z,y){var A=d.get(z);if(A.options){return z}if(y.hover&&y.hoverables[z.nodeName.toLowerCase()]){b.attach(z)}A.options=y;return z}function i(y){var z={};return function(A){if(!z.hasOwnProperty(A)){z[A]=y.apply(null,arguments)}return z[A]}}function c(D,C){if(!C){C=l.getStyle(D)}var z=l.quotedList(C.get("fontFamily").toLowerCase()),B;for(var A=0,y=z.length;A<y;++A){B=z[A];if(h[B]){return h[B].get(C.get("fontStyle"),C.get("fontWeight"))}}return null}function f(y){return document.getElementsByTagName(y)}function g(){var y={},B;for(var A=0,z=arguments.length;A<z;++A){for(B in arguments[A]){y[B]=arguments[A][B]}}return y}function m(B,J,z,K,C,A){var I=K.separate;if(I=="none"){return w[K.engine].apply(null,arguments)}var H=document.createDocumentFragment(),E;var F=J.split(n[I]),y=(I=="words");if(y&&s){if(/^\s/.test(J)){F.unshift("")}if(/\s$/.test(J)){F.push("")}}for(var G=0,D=F.length;G<D;++G){E=w[K.engine](B,y?l.textAlign(F[G],z,G,D):F[G],z,K,C,A,G<D-1);if(E){H.appendChild(E)}}return H}function j(z,G){var A,y,D,F;for(var B=r(z,G).firstChild;B;B=D){D=B.nextSibling;F=false;if(B.nodeType==1){if(!B.firstChild){continue}if(!/cufon/.test(B.className)){arguments.callee(B,G);continue}else{F=true}}if(!y){y=l.getStyle(z).extend(G)}if(!A){A=c(z,y)}if(!A){continue}if(F){w[G.engine](A,null,y,G,B,z);continue}var E=B.data;if(E===""){continue}var C=m(A,E,y,G,B,z);if(C){B.parentNode.replaceChild(C,B)}else{B.parentNode.removeChild(B)}}}var s=" ".split(/\s+/).length==0;var d=new x();var b=new p();var v=[];var w={},h={},t={enableTextDecoration:false,engine:null,hover:false,hoverables:{a:true},printable:true,selector:(window.Sizzle||(window.jQuery&&function(y){return jQuery(y)})||(window.dojo&&dojo.query)||(window.$$&&function(y){return $$(y)})||(window.$&&function(y){return $(y)})||(document.querySelectorAll&&function(y){return document.querySelectorAll(y)})||f),separate:"words",textShadow:"none"};var n={words:/\s+/,characters:""};k.now=function(){u.ready();return k};k.refresh=function(){var A=v.splice(0,v.length);for(var z=0,y=A.length;z<y;++z){k.replace.apply(null,A[z])}return k};k.registerEngine=function(z,y){if(!y){return k}w[z]=y;return k.set("engine",z)};k.registerFont=function(A){var y=new q(A),z=y.family;if(!h[z]){h[z]=new e()}h[z].add(y);return k.set("fontFamily",'"'+z+'"')};k.replace=function(A,z,y){z=g(t,z);if(!z.engine){return k}if(typeof z.textShadow=="string"&&z.textShadow){z.textShadow=l.textShadow(z.textShadow)}if(!y){v.push(arguments)}if(A.nodeType||typeof A=="string"){A=[A]}l.ready(function(){for(var C=0,B=A.length;C<B;++C){var D=A[C];if(typeof D=="string"){k.replace(z.selector(D),z,true)}else{j(D,z)}}});return k};k.replaceElement=function(z,y){y=g(t,y);if(typeof y.textShadow=="string"&&y.textShadow){y.textShadow=l.textShadow(y.textShadow)}return j(z,y)};k.engines=w;k.fonts=h;k.getOptions=function(){return g(t)};k.set=function(y,z){t[y]=z;return k};return k})();Cufon.registerEngine("canvas",(function(){var b=document.createElement("canvas");if(!b||!b.getContext||!b.getContext.apply){return}b=null;var a=Cufon.CSS.supports("display","inline-block");var e=!a&&(document.compatMode=="BackCompat"||/frameset|transitional/i.test(document.doctype.publicId));var f=document.createElement("style");f.type="text/css";f.appendChild(document.createTextNode(".cufon-canvas{text-indent:0}@media screen,projection{.cufon-canvas{display:inline;display:inline-block;position:relative;vertical-align:middle"+(e?"":";font-size:1px;line-height:1px")+"}.cufon-canvas .cufon-alt{display:-moz-inline-box;display:inline-block;width:0;height:0;overflow:hidden}"+(a?".cufon-canvas canvas{position:relative}":".cufon-canvas canvas{position:absolute}")+"}@media print{.cufon-canvas{padding:0 !important}.cufon-canvas canvas{display:none}.cufon-canvas .cufon-alt{display:inline}}"));document.getElementsByTagName("head")[0].appendChild(f);function d(p,h){var n=0,m=0;var g=[],o=/([mrvxe])([^a-z]*)/g,k;generate:for(var j=0;k=o.exec(p);++j){var l=k[2].split(",");switch(k[1]){case"v":g[j]={m:"bezierCurveTo",a:[n+~~l[0],m+~~l[1],n+~~l[2],m+~~l[3],n+=~~l[4],m+=~~l[5]]};break;case"r":g[j]={m:"lineTo",a:[n+=~~l[0],m+=~~l[1]]};break;case"m":g[j]={m:"moveTo",a:[n=~~l[0],m=~~l[1]]};break;case"x":g[j]={m:"closePath"};break;case"e":break generate}h[g[j].m].apply(h,g[j].a)}return g}function c(m,k){for(var j=0,h=m.length;j<h;++j){var g=m[j];k[g.m].apply(k,g.a)}}return function(Y,C,T,w,H,Z){var m=(C===null);var F=Y.viewBox;var n=T.getSize("fontSize",Y.baseSize);var R=T.get("letterSpacing");R=(R=="normal")?0:n.convertFrom(parseInt(R,10));var G=0,S=0,Q=0,A=0;var E=w.textShadow,O=[];if(E){for(var X=0,U=E.length;X<U;++X){var K=E[X];var N=n.convertFrom(parseFloat(K.offX));var M=n.convertFrom(parseFloat(K.offY));O[X]=[N,M];if(M<G){G=M}if(N>S){S=N}if(M>Q){Q=M}if(N<A){A=N}}}var ad=Cufon.CSS.textTransform(m?H.alt:C,T).split("");var h=0,B=null;var v=0,J=1;for(var X=0,U=ad.length;X<U;++X){if(ad[X]==="\n"){J++;if(h>v){v=h}h=0;continue}var z=Y.glyphs[ad[X]]||Y.missingGlyph;if(!z){continue}h+=B=Number(z.w||Y.w)+R}h=Math.max(v,h);if(B===null){return null}S+=(F.width-B);A+=F.minX;var u,o;if(m){u=H;o=H.firstChild}else{u=document.createElement("span");u.className="cufon cufon-canvas";u.alt=C;o=document.createElement("canvas");u.appendChild(o);if(w.printable){var V=document.createElement("span");V.className="cufon-alt";V.appendChild(document.createTextNode(C));u.appendChild(V)}}var ae=u.style;var L=o.style;var k=n.convert(F.height-G+Q);var ac=Math.ceil(k);var P=ac/k;o.width=Math.ceil(n.convert(h+S-A)*P);o.height=ac;G+=F.minY;L.top=Math.round(n.convert(G-Y.ascent))+"px";L.left=Math.round(n.convert(A))+"px";var j=Math.ceil(n.convert(h*P));var s=j+"px";var r=n.convert(Y.height);var D=(w.lineHeight-1)*n.convert(-Y.ascent/5)*(J-1);Cufon.textOptions.width=j;Cufon.textOptions.height=(r*J)+D;Cufon.textOptions.lines=J;if(a){ae.width=s;ae.height=r+"px"}else{ae.paddingLeft=s;ae.paddingBottom=(r-1)+"px"}var aa=Cufon.textOptions.context||o.getContext("2d"),I=ac/F.height;aa.save();aa.scale(I,I);aa.translate(-A-((1/I*o.width)/2)+(Cufon.fonts[Y.family].offsetLeft||0),-G-(Cufon.textOptions.height/I)/2);aa.lineWidth=Y.face["underline-thickness"];aa.save();function p(i,g){aa.strokeStyle=g;aa.beginPath();aa.moveTo(0,i);aa.lineTo(h,i);aa.stroke()}var q=w.enableTextDecoration?Cufon.CSS.textDecoration(Z,T):{},t=w.fontStyle==="italic";function ab(){aa.save();aa.fillStyle=w.backgroundColor;var ag=0;for(var y=0,x=ad.length;y<x;++y){if(ad[y]==="\n"){aa.translate(-ag,-Y.ascent-((Y.ascent/5)*w.lineHeight));ag=0;continue}var af=Y.glyphs[ad[y]]||Y.missingGlyph;if(!af){continue}var g=Number(af.w||Y.w)+R;aa.save();aa.translate(0,Y.ascent);aa.fillRect(0,0,g+10,-Y.ascent+Y.descent);aa.restore();aa.translate(g,0);ag+=g}aa.restore()}function W(){aa.fillStyle=Cufon.textOptions.color||T.get("color");var ag=0;for(var y=0,x=ad.length;y<x;++y){if(ad[y]==="\n"){aa.translate(-ag,-Y.ascent-((Y.ascent/5)*w.lineHeight));ag=0;continue}var af=Y.glyphs[ad[y]]||Y.missingGlyph;if(!af){continue}var g=Number(af.w||Y.w)+R;if(q){aa.save();aa.strokeStyle=aa.fillStyle;aa.beginPath();if(q.underline){aa.moveTo(0,-Y.face["underline-position"]);aa.lineTo(g,-Y.face["underline-position"])}if(q.overline){aa.moveTo(0,Y.ascent);aa.lineTo(g,Y.ascent)}if(q["line-through"]){aa.moveTo(0,-Y.descent);aa.lineTo(g,-Y.descent)}aa.stroke();aa.restore()}if(t){aa.save();aa.transform(1,0,-0.25,1,0,0)}aa.beginPath();if(af.d){if(af.code){c(af.code,aa)}else{af.code=d("m"+af.d,aa)}}aa.fill();if(w.strokeStyle){aa.closePath();aa.save();aa.lineWidth=w.strokeWidth;aa.strokeStyle=w.strokeStyle;aa.stroke();aa.restore()}if(t){aa.restore()}aa.translate(g,0);ag+=g}}if(E){for(var X=0,U=E.length;X<U;++X){var K=E[X];aa.save();aa.fillStyle=K.color;aa.translate.apply(aa,O[X]);W();aa.restore()}}aa.save();ab();W();aa.restore();aa.restore();aa.restore();return u}})());Cufon.registerEngine("vml",(function(){if(!document.namespaces){return}var d=document.createElement("canvas");if(d&&d.getContext&&d.getContext.apply){return}if(document.namespaces.cvml==null){document.namespaces.add("cvml","urn:schemas-microsoft-com:vml")}var b=document.createElement("cvml:shape");b.style.behavior="url(#default#VML)";if(!b.coordsize){return}b=null;document.write('<style type="text/css">.cufon-vml-canvas{text-indent:0}@media screen{cvml\\:shape,cvml\\:shadow{behavior:url(#default#VML);display:block;antialias:true;position:absolute}.cufon-vml-canvas{position:absolute;text-align:left}.cufon-vml{display:inline-block;position:relative;vertical-align:middle}.cufon-vml .cufon-alt{position:absolute;left:-10000in;font-size:1px}a .cufon-vml{cursor:pointer}}@media print{.cufon-vml *{display:none}.cufon-vml .cufon-alt{display:inline}}</style>');function c(e,f){return a(e,/(?:em|ex|%)$/i.test(f)?"1em":f)}function a(h,i){if(/px$/i.test(i)){return parseFloat(i)}var g=h.style.left,f=h.runtimeStyle.left;h.runtimeStyle.left=h.currentStyle.left;h.style.left=i;var e=h.style.pixelLeft;h.style.left=g;h.runtimeStyle.left=f;return e}return function(T,z,O,w,D,U,M){var h=(z===null);if(h){z=D.alt}var B=T.viewBox;var j=O.computedFontSize||(O.computedFontSize=new Cufon.CSS.Size(c(U,O.get("fontSize"))+"px",T.baseSize));var L=O.computedLSpacing;if(L==undefined){L=O.get("letterSpacing");O.computedLSpacing=L=(L=="normal")?0:~~j.convertFrom(a(U,L))}var t,m;if(h){t=D;m=D.firstChild}else{t=document.createElement("span");t.className="cufon cufon-vml";t.alt=z;m=document.createElement("span");m.className="cufon-vml-canvas";t.appendChild(m);if(w.printable){var R=document.createElement("span");R.className="cufon-alt";R.appendChild(document.createTextNode(z));t.appendChild(R)}if(!M){t.appendChild(document.createElement("cvml:shape"))}}var Z=t.style;var G=m.style;var f=j.convert(B.height),W=Math.ceil(f);var K=W/f;var J=B.minX,I=B.minY;G.height=W;G.top=Math.round(j.convert(I-T.ascent));G.left=Math.round(j.convert(J));Z.height=j.convert(T.height)+"px";var p=w.enableTextDecoration?Cufon.CSS.textDecoration(U,O):{};var y=O.get("color");var X=Cufon.CSS.textTransform(z,O).split("");var e=0,H=0,q=null;var x,r,A=w.textShadow;for(var S=0,Q=0,P=X.length;S<P;++S){x=T.glyphs[X[S]]||T.missingGlyph;if(x){e+=q=~~(x.w||T.w)+L}}if(q===null){return null}var s=-J+e+(B.width-q);var Y=j.convert(s*K),N=Math.round(Y);var F=s+","+B.height,g;var C="r"+F+"nsnf";for(S=0;S<P;++S){x=T.glyphs[X[S]]||T.missingGlyph;if(!x){continue}if(h){r=m.childNodes[Q];if(r.firstChild){r.removeChild(r.firstChild)}}else{r=document.createElement("cvml:shape");m.appendChild(r)}r.stroked="f";r.coordsize=F;r.coordorigin=g=(J-H)+","+I;r.path=(x.d?"m"+x.d+"xe":"")+"m"+g+C;r.fillcolor=y;var V=r.style;V.width=N;V.height=W;if(A){var o=A[0],n=A[1];var v=Cufon.CSS.color(o.color),u;var E=document.createElement("cvml:shadow");E.on="t";E.color=v.color;E.offset=o.offX+","+o.offY;if(n){u=Cufon.CSS.color(n.color);E.type="double";E.color2=u.color;E.offset2=n.offX+","+n.offY}E.opacity=v.opacity||(u&&u.opacity)||1;r.appendChild(E)}H+=~~(x.w||T.w)+L;++Q}Z.width=Math.max(Math.ceil(j.convert(e*K)),0);return t}})());(function(n){var i=n.fabric||(n.fabric={}),k=Array.prototype.slice,j=Function.prototype.apply;i.util={};(function(){function A(D,C){var B=D.indexOf(C);if(B!==-1){D.splice(B,1)}return D}function y(C,B){return Math.floor(Math.random()*(B-C+1))+C}var w=Math.PI/180;function x(B){return B*w}function v(C,B){return parseFloat(Number(C).toFixed(B))}function z(){return false}i.util.removeFromArray=A;i.util.degreesToRadians=x;i.util.toFixed=v;i.util.getRandomInt=y;i.util.falseFunction=z})();if(!Array.prototype.indexOf){Array.prototype.indexOf=function(w,x){var v=this.length>>>0;x=Number(x)||0;x=Math[x<0?"ceil":"floor"](x);if(x<0){x+=v}for(;x<v;x++){if(x in this&&this[x]===w){return x}}return -1}}if(!Array.prototype.forEach){Array.prototype.forEach=function(y,x){for(var w=0,v=this.length>>>0;w<v;w++){if(w in this){y.call(x,this[w],w,this)}}}}if(!Array.prototype.map){Array.prototype.map=function(z,y){var w=[];for(var x=0,v=this.length>>>0;x<v;x++){if(x in this){w[x]=z.call(y,this[x],x,this)}}return w}}if(!Array.prototype.every){Array.prototype.every=function(y,x){for(var w=0,v=this.length>>>0;w<v;w++){if(w in this&&!y.call(x,this[w],w,this)){return false}}return true}}if(!Array.prototype.some){Array.prototype.some=function(y,x){for(var w=0,v=this.length>>>0;w<v;w++){if(w in this&&y.call(x,this[w],w,this)){return true}}return false}}if(!Array.prototype.filter){Array.prototype.filter=function(z,y){var w=[],A;for(var x=0,v=this.length>>>0;x<v;x++){if(x in this){A=this[x];if(z.call(y,A,x,this)){w.push(A)}}}return w}}if(!Array.prototype.reduce){Array.prototype.reduce=function(x){var v=this.length>>>0,w=0,y;if(arguments.length>1){y=arguments[1]}else{do{if(w in this){y=this[w++];break}if(++w>=v){throw new TypeError()}}while(true)}for(;w<v;w++){if(w in this){y=x.call(null,y,this[w],w,this)}}return y}}function u(A,z){var x=k.call(arguments,2),w=[];for(var y=0,v=A.length;y<v;y++){w[y]=x.length?A[y][z].apply(A[y],x):A[y][z].call(A[y])}return w}function p(y,x){var w=y.length-1,v=x?y[w][x]:y[w];if(x){while(w--){if(y[w][x]>=v){v=y[w][x]}}}else{while(w--){if(y[w]>=v){v=y[w]}}}return v}function m(y,x){var w=y.length-1,v=x?y[w][x]:y[w];if(x){while(w--){if(y[w][x]<v){v=y[w][x]}}}else{while(w--){if(y[w]<v){v=y[w]}}}return v}i.util.array={invoke:u,min:m,max:p};function r(v,x){for(var w in x){v[w]=x[w]}return v}function s(v){return r({},v)}i.util.object={extend:r,clone:s};if(!String.prototype.trim){String.prototype.trim=function(){return this.replace(/^[\s\xA0]+/,"").replace(/[\s\xA0]+$/,"")}}function t(v){return v.replace(/-+(.)?/g,function(w,x){return x?x.toUpperCase():""})}function f(v){return v.charAt(0).toUpperCase()+v.slice(1).toLowerCase()}i.util.string={camelize:t,capitalize:f};if(!Function.prototype.bind){Function.prototype.bind=function(v){var x=this,w=k.call(arguments,1);return w.length?function(){return j.call(x,v,w.concat(k.call(arguments)))}:function(){return j.call(x,v,arguments)}}}(function(){var x=(function(){for(var z in {toString:1}){if(z==="toString"){return false}}return true})();var w;if(x){w=function(z,B){if(B.toString!==Object.prototype.toString){z.prototype.toString=B.toString}if(B.valueOf!==Object.prototype.valueOf){z.prototype.valueOf=B.valueOf}for(var A in B){z.prototype[A]=B[A]}}}else{w=function(z,B){for(var A in B){z.prototype[A]=B[A]}}}function v(){}function y(){var C=null,B=k.call(arguments,0);if(typeof B[0]==="function"){C=B.shift()}function z(){this.initialize.apply(this,arguments)}z.superclass=C;z.subclasses=[];if(C){v.prototype=C.prototype;z.prototype=new v;C.subclasses.push(z)}for(var A=0,D=B.length;A<D;A++){w(z,B[A])}if(!z.prototype.initialize){z.prototype.initialize=emptyFunction}z.prototype.constructor=z;return z}i.util.createClass=y})();(function(N){function J(R){var U=Array.prototype.slice.call(arguments,1),T,S,Q=U.length;for(S=0;S<Q;S++){T=typeof R[U[S]];if(!(/^(?:function|object|unknown)$/).test(T)){return false}}return true}var G=(function(){if(typeof document.documentElement.uniqueID!=="undefined"){return function(R){return R.uniqueID}}var Q=0;return function(R){return R.__uniqueID||(R.__uniqueID="uniqueID__"+Q++)}})();var D,O;(function(){var Q={};D=function(R){return Q[R]};O=function(S,R){Q[S]=R}})();function B(Q,R){return{handler:R,wrappedHandler:I(Q,R)}}function I(Q,R){return function(S){R.call(D(Q),S||window.event)}}function C(R,Q){return function(V){if(L[R]&&L[R][Q]){var T=L[R][Q];for(var U=0,S=T.length;U<S;U++){T[U].call(this,V||window.event)}}}}var M=(J(document.documentElement,"addEventListener","removeEventListener")&&J(window,"addEventListener","removeEventListener")),E=(J(document.documentElement,"attachEvent","detachEvent")&&J(window,"attachEvent","detachEvent")),K={},L={},H,z;if(M){H=function(R,Q,S){R.addEventListener(Q,S,false)};z=function(R,Q,S){R.removeEventListener(Q,S,false)}}else{if(E){H=function(S,Q,T){var R=G(S);O(R,S);if(!K[R]){K[R]={}}if(!K[R][Q]){K[R][Q]=[]}var U=B(R,T);K[R][Q].push(U);S.attachEvent("on"+Q,U.wrappedHandler)};z=function(U,R,V){var T=G(U),W;if(K[T]&&K[T][R]){for(var S=0,Q=K[T][R].length;S<Q;S++){W=K[T][R][S];if(W&&W.handler===V){U.detachEvent("on"+R,W.wrappedHandler);K[T][R][S]=null}}}}}else{H=function(S,Q,T){var R=G(S);if(!L[R]){L[R]={}}if(!L[R][Q]){L[R][Q]=[];var U=S["on"+Q];if(U){L[R][Q].push(U)}S["on"+Q]=C(R,Q)}L[R][Q].push(T)};z=function(V,S,W){var U=G(V);if(L[U]&&L[U][S]){var R=L[U][S];for(var T=0,Q=R.length;T<Q;T++){if(R[T]===W){R.splice(T,1)}}}}}}i.util.addListener=H;i.util.removeListener=z;var x={};function A(Q,R){if(!x[Q]){x[Q]=[]}x[Q].push(R)}function y(Q,R){if(x[Q]){i.util.removeFromArray(x[Q],R)}}function P(T,S){var R=x[T];if(!R){return}for(var U=0,Q=R.length;U<Q;U++){R[U]({memo:S})}}function F(Q){return{x:w(Q),y:v(Q)}}function w(S){var R=document.documentElement,Q=document.body||{scrollLeft:0};return S.pageX||((typeof S.clientX!="unknown"?S.clientX:0)+(R.scrollLeft||Q.scrollLeft)-(R.clientLeft||0))}function v(S){var R=document.documentElement,Q=document.body||{scrollTop:0};return S.pageY||((typeof S.clientY!="unknown"?S.clientY:0)+(R.scrollTop||Q.scrollTop)-(R.clientTop||0))}i.util.getPointer=F;i.util.observeEvent=A;i.util.stopObservingEvent=y;i.util.fireEvent=P})(this);(function(){function z(E,G){var I=E.style,D;if(typeof G==="string"){E.style.cssText+=";"+G;return G.indexOf("opacity")>-1?x(E,G.match(/opacity:\s*(\d?\.?\d*)/)[1]):E}for(var H in G){if(H==="opacity"){x(E,G[H])}else{var F=(H==="float"||H==="cssFloat")?(typeof I.styleFloat==="undefined"?"cssFloat":"styleFloat"):H;I[F]=G[H]}}return E}var C=document.createElement("div"),B=typeof C.style.opacity==="string",w=typeof C.style.filter==="string",v=document.defaultView,A=v&&typeof v.getComputedStyle!=="undefined",y=/alpha\s*\(\s*opacity\s*=\s*([^\)]+)\)/,x=function(D){return D};if(B){x=function(D,E){D.style.opacity=E;return D}}else{if(w){x=function(D,E){var F=D.style;if(D.currentStyle&&!D.currentStyle.hasLayout){F.zoom=1}if(y.test(F.filter)){E=E>=0.9999?"":("alpha(opacity="+(E*100)+")");F.filter=F.filter.replace(y,E)}else{F.filter+=" alpha(opacity="+(E*100)+")"}return D}}}i.util.setStyle=z})();var d=Array.prototype.slice;function q(v){return typeof v==="string"?document.getElementById(v):v}function o(v){return d.call(v,0)}try{var h=o(document.childNodes) instanceof Array}catch(e){}if(!h){o=function(w){var v=new Array(w.length),x=w.length;while(x--){v[x]=w[x]}return v}}function b(w,v){var x=document.createElement(w);for(var y in v){if(y==="class"){x.className=v[y]}else{if(y==="for"){x.htmlFor=v[y]}else{x.setAttribute(y,v[y])}}}return x}function g(v,w){if((" "+v.className+" ").indexOf(" "+w+" ")===-1){v.className+=(v.className?" ":"")+w}}function a(w,x,v){if(typeof x==="string"){x=b(x,v)}if(w.parentNode){w.parentNode.replaceChild(x,w)}x.appendChild(w);return x}function l(w){var v=0,x=0;do{v+=w.offsetTop||0;x+=w.offsetLeft||0;w=w.offsetParent}while(w);return({left:x,top:v})}(function(){var v=document.documentElement.style;var w="userSelect" in v?"userSelect":"MozUserSelect" in v?"MozUserSelect":"WebkitUserSelect" in v?"WebkitUserSelect":"KhtmlUserSelect" in v?"KhtmlUserSelect":"";function x(y){if(typeof y.onselectstart!=="undefined"){y.onselectstart=i.util.falseFunction}if(w){y.style[w]="none"}else{if(typeof y.unselectable=="string"){y.unselectable="on"}}return y}i.util.makeElementUnselectable=x})();(function(){function v(y,C){var A=document.getElementsByTagName("head")[0],z=document.createElement("script"),B=true;z.type="text/javascript";z.setAttribute("runat","server");z.onload=z.onreadystatechange=function(D){if(B){if(typeof this.readyState=="string"&&this.readyState!=="loaded"&&this.readyState!=="complete"){return}B=false;C(D||window.event);z=z.onload=z.onreadystatechange=null}};z.src=y;A.appendChild(z)}function x(y,z){w.load(y);z()}i.util.getScript=v;var w=n.Jaxer;if(w&&w.load){i.util.getScript=x}})();function c(H){H||(H={});var w=+new Date(),A=H.duration||500,G=w+A,z,F,C=H.onChange||function(){},B=H.abort||function(){return false},D=H.easing||function(I){return(-Math.cos(I*Math.PI)/2)+0.5},v="startValue" in H?H.startValue:0,E="endValue" in H?H.endValue:100,y=v>E;H.onStart&&H.onStart();var x=setInterval(function(){z=+new Date();F=z>G?1:(z-w)/A;C(y?(v-(v-E)*D(F)):(v+(E-v)*D(F)));if(z>G||B()){clearInterval(x);H.onComplete&&H.onComplete()}},10);return x}i.util.getById=q;i.util.toArray=o;i.util.makeElement=b;i.util.addClass=g;i.util.wrapElement=a;i.util.getElementOffset=l;i.util.animate=c;(function(){function y(z,A){return z+(/\?/.test(z)?"&":"?")+A}var x=(function(){var C=[function(){return new ActiveXObject("Microsoft.XMLHTTP")},function(){return new ActiveXObject("Msxml2.XMLHTTP")},function(){return new ActiveXObject("Msxml2.XMLHTTP.3.0")},function(){return new XMLHttpRequest()}];for(var z=C.length;z--;){try{var B=C[z]();if(B){return C[z]}}catch(A){}}})();function v(){}function w(B,A){A||(A={});var E=A.method?A.method.toUpperCase():"GET",D=A.onComplete||function(){},C=x(),z;C.onreadystatechange=function(){if(C.readyState===4){D(C);C.onreadystatechange=v}};if(E==="GET"){z=null;if(typeof A.parameters=="string"){B=y(B,A.parameters)}}C.open(E,B,true);if(E==="POST"||E==="PUT"){C.setRequestHeader("Content-Type","application/x-www-form-urlencoded")}C.send(z);return C}i.util.request=w})()})(this);(function(b){var c=b.fabric||(b.fabric={}),h=c.util.object.extend,f=c.util.string.capitalize,i=c.util.object.clone;var d={cx:"left",x:"left",cy:"top",y:"top",r:"radius","fill-opacity":"opacity","fill-rule":"fillRule","stroke-width":"strokeWidth",transform:"transformMatrix"};function m(q,p){if(!q){return}var s,o,n={};if(q.parentNode&&/^g$/i.test(q.parentNode.nodeName)){n=c.parseAttributes(q.parentNode,p)}var r=p.reduce(function(u,t){s=q.getAttribute(t);o=parseFloat(s);if(s){if((t==="fill"||t==="stroke")&&s==="none"){s=""}if(t==="fill-rule"){s=(s==="evenodd")?"destination-over":s}if(t==="transform"){s=c.parseTransformAttribute(s)}if(t in d){t=d[t]}u[t]=isNaN(o)?s:o}return u},{});r=h(r,h(a(q),c.parseStyleAttribute(q)));return h(n,r)}c.parseTransformAttribute=(function(){function n(G,H){var I=H[0];G[0]=Math.cos(I);G[1]=Math.sin(I);G[2]=-Math.sin(I);G[3]=Math.cos(I)}function s(I,J){var H=J[0],G=(J.length===2)?J[1]:J[0];I[0]=H;I[3]=G}function D(G,H){G[2]=H[0]}function p(G,H){G[1]=H[0]}function A(G,H){G[4]=H[0];if(H.length===2){G[5]=H[1]}}var u=[1,0,0,1,0,0],o="(?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?)",E="(?:\\s+,?\\s*|,\\s*)",v="(?:(skewX)\\s*\\(\\s*("+o+")\\s*\\))",t="(?:(skewY)\\s*\\(\\s*("+o+")\\s*\\))",C="(?:(rotate)\\s*\\(\\s*("+o+")(?:"+E+"("+o+")"+E+"("+o+"))?\\s*\\))",F="(?:(scale)\\s*\\(\\s*("+o+")(?:"+E+"("+o+"))?\\s*\\))",y="(?:(translate)\\s*\\(\\s*("+o+")(?:"+E+"("+o+"))?\\s*\\))",B="(?:(matrix)\\s*\\(\\s*("+o+")"+E+"("+o+")"+E+"("+o+")"+E+"("+o+")"+E+"("+o+")"+E+"("+o+")\\s*\\))",z="(?:"+B+"|"+y+"|"+F+"|"+C+"|"+v+"|"+t+")",w="(?:"+z+"(?:"+E+z+")*)",q="^\\s*(?:"+w+"?)\\s*$",x=new RegExp(q),r=new RegExp(z);return function(H){var G=u.concat();if(!H||(H&&!x.test(H))){return G}H.replace(r,function(L){var I=new RegExp(z).exec(L).filter(function(M){return(M!==""&&M!=null)}),J=I[1],K=I.slice(2).map(parseFloat);switch(J){case"translate":A(G,K);break;case"rotate":n(G,K);break;case"scale":s(G,K);break;case"skewX":D(G,K);break;case"skewY":p(G,K);break;case"matrix":G=K;break}});return G}})();function j(q){if(!q){return null}q=q.trim();var s=q.indexOf(",")>-1;q=q.split(/\s+/);var o=[];if(s){for(var p=0,n=q.length;p<n;p++){var r=q[p].split(",");o.push({x:parseFloat(r[0]),y:parseFloat(r[1])})}}else{for(var p=0,n=q.length;p<n;p+=2){o.push({x:parseFloat(q[p]),y:parseFloat(q[p+1])})}}if(o.length%2!==0){}return o}function g(o){var n={},p=o.getAttribute("style");if(p){if(typeof p=="string"){p=p.replace(/;$/,"").split(";");n=p.reduce(function(s,v){var r=v.split(":"),t=r[0].trim(),u=r[1].trim();s[t]=u;return s},{})}else{for(var q in p){if(typeof p[q]!=="undefined"){n[q]=p[q]}}}}return n}function l(s){var o=c.Element.activeInstance,n=o?o.getContext():null;if(!n){return}for(var p=s.length;p--;){var q=s[p].get("fill");if(/^url\(/.test(q)){var r=q.slice(5,q.length-1);if(c.gradientDefs[r]){s[p].set("fill",c.Gradient.fromElement(c.gradientDefs[r],n,s[p]))}}}}function e(o,w,x){var n=Array(o.length),r=o.length;function p(){if(--r===0){n=n.filter(function(y){return y!=null});l(n);w(n)}}for(var t=0,q,s=o.length;t<s;t++){q=o[t];var v=c[f(q.tagName)];if(v&&v.fromElement){try{if(v.fromElement.async){v.fromElement(q,(function(y){return function(z){n.splice(y,0,z);p()}})(t),x)}else{n.splice(t,0,v.fromElement(q,x));p()}}catch(u){c.log(u.message||u)}}else{p()}}}function k(s){var q=s.getElementsByTagName("style"),o={},t;for(var p=0,n=q.length;p<n;p++){var r=q[0].textContent;r=r.replace(/\/\*[\s\S]*?\*\//g,"");t=r.match(/[^{]*\{[\s\S]*?\}/g);t=t.map(function(u){return u.trim()});t.forEach(function(z){var x=z.match(/([\s\S]*?)\s*\{([^}]*)\}/),z=x[1],u=x[2].trim(),B=u.replace(/;$/,"").split(/\s*;\s*/);if(!o[z]){o[z]={}}for(var w=0,y=B.length;w<y;w++){var v=B[w].split(/\s*:\s*/),C=v[0],A=v[1];o[z][C]=A}})}return o}function a(o){var u=o.nodeName,p=o.getAttribute("class"),t=o.getAttribute("id"),q={};for(var s in c.cssRules){var n=(p&&new RegExp("^\\."+p).test(s))||(t&&new RegExp("^#"+t).test(s))||(new RegExp("^"+u).test(s));if(n){for(var r in c.cssRules[s]){q[r]=c.cssRules[s][r]}}}return q}c.parseSVGDocument=(function(){var n=/^(path|circle|polygon|polyline|ellipse|rect|line|image)$/;var o="(?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?)";var p=new RegExp("^\\s*("+o+"+)\\s*,?\\s*("+o+"+)\\s*,?\\s*("+o+"+)\\s*,?\\s*("+o+"+)\\s*$");function q(r,s){while(r&&(r=r.parentNode)){if(s.test(r.nodeName)){return true}}return false}return function(A,C){if(!A){return}var u=new Date(),z=c.util.toArray(A.getElementsByTagName("*"));var r=z.filter(function(E){return n.test(E.tagName)&&!q(E,/^(?:pattern|defs)$/)});if(!r||(r&&!r.length)){return}var s=A.getAttribute("viewBox"),x=A.getAttribute("width"),v=A.getAttribute("height"),t=null,B=null,y,w;if(s&&(s=s.match(p))){y=parseInt(s[1],10);w=parseInt(s[2],10);t=parseInt(s[3],10);B=parseInt(s[4],10)}t=x?parseFloat(x):t;B=v?parseFloat(v):B;var D={width:t,height:B};c.gradientDefs=c.getGradientDefs(A);c.cssRules=k(A);c.parseElements(r,function(E){c.documentParsingTime=new Date()-u;if(C){C(E,D)}},i(D))}})();h(c,{parseAttributes:m,parseElements:e,parseStyleAttribute:g,parsePointsAttribute:j,getCSSRules:k})})(this);(function(){function c(h){var g=h.getAttribute("style");if(g){var k=g.split(/\s*;\s*/);for(var f=k.length;f--;){var e=k[f].split(/\s*:\s*/),d=e[0].trim(),j=e[1].trim();if(d==="stop-color"){return j}}}}fabric.Gradient={create:function(l,m){m||(m={});var f=m.x1||0,k=m.y1||0,e=m.x2||l.canvas.width,i=m.y2||0,g=m.colorStops;var j=l.createLinearGradient(f,k,e,i);for(var h in g){var d=g[h];j.addColorStop(parseFloat(h),d)}return j},fromElement:function(d,m,l){var k=d.getElementsByTagName("stop"),d,f,e={},g;for(var h=k.length;h--;){d=k[h];f=parseInt(d.getAttribute("offset"),10)/100;e[f]=c(d)||d.getAttribute("stop-color")}var j={x1:d.getAttribute("x1")||0,y1:d.getAttribute("y1")||0,x2:d.getAttribute("x2")||"100%",y2:d.getAttribute("y2")||0};a(l,j);return fabric.Gradient.create(m,{x1:j.x1,y1:j.y1,x2:j.x2,y2:j.y2,colorStops:e})},forObject:function(g,d,e){e||(e={});a(g,e);var f=fabric.Gradient.create(d,{x1:e.x1-(g.width/2),y1:e.y1-(g.height/2),x2:e.x2-(g.width/2),y2:e.y2-(g.height/2),colorStops:e.colorStops});return f}};function a(f,e){for(var g in e){if(typeof e[g]==="string"&&/^\d+%$/.test(e[g])){var d=parseFloat(e[g],10);if(g==="x1"||g==="x2"){e[g]=f.width*d/100}else{if(g==="y1"||g==="y2"){e[g]=f.height*d/100}}}if(g==="x1"||g==="x2"){e[g]-=f.width/2}else{if(g==="y1"||g==="y2"){e[g]-=f.height/2}}}}function b(j){var f=j.getElementsByTagName("linearGradient"),d=j.getElementsByTagName("radialGradient"),g,h={};for(var e=f.length;e--;){g=f[e];h[g.id]=g}for(var e=d.length;e--;){g=d[e];h[g.id]=g}return h}fabric.getGradientDefs=b})();(function(b){var c=b.fabric||(b.fabric={});if(c.Point){c.warn("fabric.Point is already defined");return}c.Point=a;function a(d,e){if(arguments.length>0){this.init(d,e)}}a.prototype={constructor:a,init:function(d,e){this.x=d;this.y=e},add:function(d){return new a(this.x+d.x,this.y+d.y)},addEquals:function(d){this.x+=d.x;this.y+=d.y;return this},scalarAdd:function(d){return new a(this.x+d,this.y+d)},scalarAddEquals:function(d){this.x+=d;this.y+=d;return this},subtract:function(d){return new a(this.x-d.x,this.y-d.y)},subtractEquals:function(d){this.x-=d.x;this.y-=d.y;return this},scalarSubtract:function(d){return new a(this.x-d,this.y-d)},scalarSubtractEquals:function(d){this.x-=d;this.y-=d;return this},multiply:function(d){return new a(this.x*d,this.y*d)},multiplyEquals:function(d){this.x*=d;this.y*=d;return this},divide:function(d){return new a(this.x/d,this.y/d)},divideEquals:function(d){this.x/=d;this.y/=d;return this},eq:function(d){return(this.x==d.x&&this.y==d.y)},lt:function(d){return(this.x<d.x&&this.y<d.y)},lte:function(d){return(this.x<=d.x&&this.y<=d.y)},gt:function(d){return(this.x>d.x&&this.y>d.y)},gte:function(d){return(this.x>=d.x&&this.y>=d.y)},lerp:function(e,d){return new a(this.x+(e.x-this.x)*d,this.y+(e.y-this.y)*d)},distanceFrom:function(f){var e=this.x-f.x,d=this.y-f.y;return Math.sqrt(e*e+d*d)},min:function(d){return new a(Math.min(this.x,d.x),Math.min(this.y,d.y))},max:function(d){return new a(Math.max(this.x,d.x),Math.max(this.y,d.y))},toString:function(){return this.x+","+this.y},setXY:function(d,e){this.x=d;this.y=e},setFromPoint:function(d){this.x=d.x;this.y=d.y},swap:function(e){var d=this.x,f=this.y;this.x=e.x;this.y=e.y;e.x=d;e.y=f}}})(this);(function(a){var b=a.fabric||(a.fabric={});if(b.Intersection){b.warn("fabric.Intersection is already defined");return}function c(d){if(arguments.length>0){this.init(d)}}b.Intersection=c;b.Intersection.prototype={init:function(d){this.status=d;this.points=[]},appendPoint:function(d){this.points.push(d)},appendPoints:function(d){this.points=this.points.concat(d)}};b.Intersection.intersectLineLine=function(h,f,l,k){var m,i=(k.x-l.x)*(h.y-l.y)-(k.y-l.y)*(h.x-l.x),j=(f.x-h.x)*(h.y-l.y)-(f.y-h.y)*(h.x-l.x),g=(k.y-l.y)*(f.x-h.x)-(k.x-l.x)*(f.y-h.y);if(g!=0){var e=i/g,d=j/g;if(0<=e&&e<=1&&0<=d&&d<=1){m=new c("Intersection");m.points.push(new b.Point(h.x+e*(f.x-h.x),h.y+e*(f.y-h.y)))}else{m=new c("No Intersection")}}else{if(i==0||j==0){m=new c("Coincident")}else{m=new c("Parallel")}}return m};b.Intersection.intersectLinePolygon=function(e,d,l){var m=new c("No Intersection"),f=l.length;for(var h=0;h<f;h++){var k=l[h],j=l[(h+1)%f],g=c.intersectLineLine(e,d,k,j);m.appendPoints(g.points)}if(m.points.length>0){m.status="Intersection"}return m};b.Intersection.intersectPolygonPolygon=function(j,h){var f=new c("No Intersection"),l=j.length;for(var k=0;k<l;k++){var g=j[k],e=j[(k+1)%l],d=c.intersectLinePolygon(g,e,h);f.appendPoints(d.points)}if(f.points.length>0){f.status="Intersection"}return f};b.Intersection.intersectPolygonRectangle=function(n,e,d){var g=e.min(d),m=e.max(d),f=new b.Point(m.x,g.y),l=new b.Point(g.x,m.y),k=c.intersectLinePolygon(g,f,n),j=c.intersectLinePolygon(f,m,n),i=c.intersectLinePolygon(m,l,n),h=c.intersectLinePolygon(l,g,n),o=new c("No Intersection");o.appendPoints(k.points);o.appendPoints(j.points);o.appendPoints(i.points);o.appendPoints(h.points);if(o.points.length>0){o.status="Intersection"}return o}})(this);(function(a){var b=a.fabric||(a.fabric={});if(b.Color){b.warn("fabric.Color is already defined.");return}function c(d){if(!d){this.setSource([0,0,0,1])}else{this._tryParsingColor(d)}}b.Color=c;b.Color.prototype={_tryParsingColor:function(d){var e=c.sourceFromHex(d);if(!e){e=c.sourceFromRgb(d)}if(e){this.setSource(e)}},getSource:function(){return this._source},setSource:function(d){this._source=d},toRgb:function(){var d=this.getSource();return"rgb("+d[0]+","+d[1]+","+d[2]+")"},toRgba:function(){var d=this.getSource();return"rgba("+d[0]+","+d[1]+","+d[2]+","+d[3]+")"},toHex:function(){var h=this.getSource();var f=h[0].toString(16);f=(f.length==1)?("0"+f):f;var e=h[1].toString(16);e=(e.length==1)?("0"+e):e;var d=h[2].toString(16);d=(d.length==1)?("0"+d):d;return f.toUpperCase()+e.toUpperCase()+d.toUpperCase()},getAlpha:function(){return this.getSource()[3]},setAlpha:function(e){var d=this.getSource();d[3]=e;this.setSource(d);return this},toGrayscale:function(){var f=this.getSource(),e=parseInt((f[0]*0.3+f[1]*0.59+f[2]*0.11).toFixed(0),10),d=f[3];this.setSource([e,e,e,d]);return this},toBlackWhite:function(d){var g=this.getSource(),f=(g[0]*0.3+g[1]*0.59+g[2]*0.11).toFixed(0),e=g[3],d=d||127;f=(Number(f)<Number(d))?0:255;this.setSource([f,f,f,e]);return this},overlayWith:function(k){if(!(k instanceof c)){k=new c(k)}var d=[],j=this.getAlpha(),g=0.5,h=this.getSource(),e=k.getSource();for(var f=0;f<3;f++){d.push(Math.round((h[f]*(1-g))+(e[f]*g)))}d[4]=j;this.setSource(d);return this}};b.Color.reRGBa=/^rgba?\((\d{1,3})\s*,\s*(\d{1,3})\s*,\s*(\d{1,3})(?:\s*,\s*(\d+(?:\.\d+)?))?\)$/;b.Color.reHex=/^#?([0-9a-f]{6}|[0-9a-f]{3})$/i;b.Color.fromRgb=function(d){return c.fromSource(c.sourceFromRgb(d))};b.Color.sourceFromRgb=function(d){var e=d.match(c.reRGBa);if(e){return[parseInt(e[1],10),parseInt(e[2],10),parseInt(e[3],10),e[4]?parseFloat(e[4]):1]}};b.Color.fromRgba=c.fromRgb;b.Color.fromHex=function(d){return c.fromSource(c.sourceFromHex(d))};b.Color.sourceFromHex=function(f){if(f.match(c.reHex)){var j=f.slice(f.indexOf("#")+1),e=(j.length===3),i=e?(j.charAt(0)+j.charAt(0)):j.substring(0,2),h=e?(j.charAt(1)+j.charAt(1)):j.substring(2,4),d=e?(j.charAt(2)+j.charAt(2)):j.substring(4,6);return[parseInt(i,16),parseInt(h,16),parseInt(d,16),1]}};b.Color.fromSource=function(d){var e=new c();e.setSource(d);return e}})(this);(function(r){if(fabric.Element){fabric.warn("fabric.Element is already defined.");return}var g=r.window,n=g.document,t=fabric.util.object.extend,i=fabric.util.string.capitalize,u=fabric.util.string.camelize,y=fabric.util.fireEvent,f=fabric.util.getPointer,q=fabric.util.getElementOffset,k=fabric.util.removeFromArray,j=fabric.util.addListener,e=fabric.util.removeListener,m=fabric.util.array.min,o=fabric.util.array.max,w=Math.sqrt,c=Math.pow,b=Math.atan2,l=Math.abs,p=Math.min,s=Math.max,h=new Error("Could not initialize `canvas` element"),a=500,d=0.5,v="decel",x={tr:"ne-resize",br:"se-resize",bl:"sw-resize",tl:"nw-resize",ml:"w-resize",mt:"n-resize",mr:"e-resize",mb:"s-resize"};fabric.Element=function(A,z){z||(z={});this._groupSelector=null;this._objects=[];this._context=null;this._currentTransform=null;this._activeGroup=null;this._freeDrawingXPoints=[];this._freeDrawingYPoints=[];this._createUpperCanvas(A);this._initOptions(z);this._initWrapperElement();this._createLowerCanvas();this._initEvents();if(z.overlayImage){this.setOverlayImage(z.overlayImage)}this.calcOffset();fabric.Element.activeInstance=this};t(fabric.Element.prototype,{backgroundColor:"rgba(0, 0, 0, 0)",selectionColor:"rgba(100, 100, 255, 0.3)",selectionBorderColor:"rgba(255, 255, 255, 0.3)",selectionLineWidth:1,freeDrawingColor:"rgb(0, 0, 0)",freeDrawingLineWidth:1,includeDefaultValues:true,shouldCacheImages:false,stateful:true,renderOnAddition:true,CANVAS_WIDTH:600,CANVAS_HEIGHT:600,CONTAINER_CLASS:"canvas-container",onBeforeScaleRotate:function(z){},onFpsUpdate:null,calcOffset:function(){this._offset=q(this.upperCanvasEl);return this},setOverlayImage:function(A,C){if(A){var B=this,z=new Image();z.onload=function(){B.overlayImage=z;if(C){C()}z=z.onload=null};z.src=A}return this},_initWrapperElement:function(){this.wrapperEl=fabric.util.wrapElement(this.upperCanvasEl,"div",{"class":this.CONTAINER_CLASS});fabric.util.setStyle(this.wrapperEl,{width:this.getWidth()+"px",height:this.getHeight()+"px",position:"relative"});fabric.util.makeElementUnselectable(this.wrapperEl)},_applyCanvasStyle:function(A){var B=this.getWidth()||A.width,z=this.getHeight()||A.height;fabric.util.setStyle(A,{position:"absolute",width:B+"px",height:z+"px",left:0,top:0});A.width=B;A.height=z;fabric.util.makeElementUnselectable(A)},_createCanvasElement:function(){var z=n.createElement("canvas");if(!z){throw h}this._initCanvasElement(z);return z},_initCanvasElement:function(z){if(typeof z.getContext==="undefined"&&typeof G_vmlCanvasManager!=="undefined"&&G_vmlCanvasManager.initElement){G_vmlCanvasManager.initElement(z)}if(typeof z.getContext==="undefined"){throw h}},_initOptions:function(z){for(var A in z){this[A]=z[A]}this.width=parseInt(this.upperCanvasEl.width,10)||0;this.height=parseInt(this.upperCanvasEl.height,10)||0;this.upperCanvasEl.style.width=this.width+"px";this.upperCanvasEl.style.height=this.height+"px"},_initEvents:function(){var z=this;this._onMouseDown=function(A){z.__onMouseDown(A)};this._onMouseUp=function(A){z.__onMouseUp(A)};this._onMouseMove=function(A){z.__onMouseMove(A)};this._onResize=function(A){z.calcOffset()};j(this.upperCanvasEl,"mousedown",this._onMouseDown);j(n,"mousemove",this._onMouseMove);j(n,"mouseup",this._onMouseUp);j(g,"resize",this._onResize)},_createUpperCanvas:function(z){this.upperCanvasEl=fabric.util.getById(z)||this._createCanvasElement();this._initCanvasElement(this.upperCanvasEl);fabric.util.addClass(this.upperCanvasEl,"upper-canvas");this._applyCanvasStyle(this.upperCanvasEl);this.contextTop=this.upperCanvasEl.getContext("2d")},_createLowerCanvas:function(){this.lowerCanvasEl=this._createCanvasElement();this.lowerCanvasEl.className="lower-canvas";this.wrapperEl.insertBefore(this.lowerCanvasEl,this.upperCanvasEl);this._applyCanvasStyle(this.lowerCanvasEl);this.contextContainer=this.lowerCanvasEl.getContext("2d")},getWidth:function(){return this.width},getHeight:function(){return this.height},setWidth:function(z){return this._setDimension("width",z)},setHeight:function(z){return this._setDimension("height",z)},setDimensions:function(z){for(var A in z){this._setDimension(A,z[A])}return this},_setDimension:function(A,z){this.lowerCanvasEl[A]=z;this.lowerCanvasEl.style[A]=z+"px";this.upperCanvasEl[A]=z;this.upperCanvasEl.style[A]=z+"px";this.wrapperEl.style[A]=z+"px";this[A]=z;this.calcOffset();this.renderAll();return this},__onMouseUp:function(D){if(this.isDrawingMode&&this._isCurrentlyDrawing){this._finalizeDrawingPath();return}if(this._currentTransform){var z=this._currentTransform,C=z.target;if(C._scaling){y("object:scaled",{target:C});C._scaling=false}var A=this._objects.length;while(A--){this._objects[A].setCoords()}if(this.stateful&&C.hasStateChanged()){C.isMoving=false;y("object:modified",{target:C})}}this._currentTransform=null;if(this._groupSelector){this._findSelectedObjects(D)}var B=this.getActiveGroup();if(B){if(this.stateful&&B.hasStateChanged()&&B.containsPoint(this.getPointer(D))){y("group:modified",{target:B})}B.setObjectsCoords();B.set("isMoving",false);this._setCursor("default")}this._groupSelector=null;this.renderAll();this._setCursorFromEvent(D,C);this._setCursor("");var E=this;setTimeout(function(){E._setCursorFromEvent(D,C)},50);y("mouse:up")},_shouldClearSelection:function(B){var A=this.findTarget(B),z=this.getActiveGroup();return(!A||(A&&z&&!z.contains(A)&&z!==A&&!B.shiftKey))},__onMouseDown:function(D){if(this.isDrawingMode){this._prepareForDrawing(D);this._captureDrawingPath(D);return}if(this._currentTransform){return}var C=this.findTarget(D),E=this.getPointer(D),A=this.getActiveGroup(),B;if(this._shouldClearSelection(D)){this._groupSelector={ex:E.x,ey:E.y,top:0,left:0};this.deactivateAllWithDispatch()}else{this.stateful&&C.saveState();if(B=C._findTargetCorner(D,this._offset)){this.onBeforeScaleRotate(C)}this._setupCurrentTransform(D,C);var z=D.shiftKey&&(A||this.getActiveObject());if(z){this._handleGroupLogic(D,C)}else{if(C!==this.getActiveGroup()){this.deactivateAll()}this.setActiveObject(C)}}this.renderAll()},getElement:function(){return this.upperCanvasEl},deactivateAllWithDispatch:function(){var z=this.getActiveGroup();if(z){y("before:group:destroyed",{target:z})}this.deactivateAll();if(z){y("after:group:destroyed")}y("selection:cleared");return this},_setupCurrentTransform:function(C,B){var A="drag",z,D=f(C);if(z=B._findTargetCorner(C,this._offset)){A=(z==="ml"||z==="mr")?"scaleX":(z==="mt"||z==="mb")?"scaleY":"rotate"}this._currentTransform={target:B,action:A,scaleX:B.scaleX,scaleY:B.scaleY,offsetX:D.x-B.left,offsetY:D.y-B.top,ex:D.x,ey:D.y,left:B.left,top:B.top,theta:B.theta,width:B.width*B.scaleX};this._currentTransform.original={left:B.left,top:B.top}},_handleGroupLogic:function(C,B){if(B.isType("group")){B=this.findTarget(C,true);if(!B||B.isType("group")){return}}var z=this.getActiveGroup();if(z){if(z.contains(B)){z.remove(B);B.setActive(false);if(z.size()===1){this.removeActiveGroup()}}else{z.add(B)}y("group:selected",{target:z});z.setActive(true)}else{if(this._activeObject){if(B!==this._activeObject){var A=new fabric.Group([this._activeObject,B]);this.setActiveGroup(A);z=this.getActiveGroup()}}B.setActive(true)}if(z){z.saveCoords()}},_prepareForDrawing:function(z){this._isCurrentlyDrawing=true;this.removeActiveObject().renderAll();var A=this.getPointer(z);this._freeDrawingXPoints.length=this._freeDrawingYPoints.length=0;this._freeDrawingXPoints.push(A.x);this._freeDrawingYPoints.push(A.y);this.contextTop.beginPath();this.contextTop.moveTo(A.x,A.y);this.contextTop.strokeStyle=this.freeDrawingColor;this.contextTop.lineWidth=this.freeDrawingLineWidth;this.contextTop.lineCap=this.contextTop.lineJoin="round"},_captureDrawingPath:function(z){var A=this.getPointer(z);this._freeDrawingXPoints.push(A.x);this._freeDrawingYPoints.push(A.y);this.contextTop.lineTo(A.x,A.y);this.contextTop.stroke()},_finalizeDrawingPath:function(){this.contextTop.closePath();this._isCurrentlyDrawing=false;var E=m(this._freeDrawingXPoints),D=m(this._freeDrawingYPoints),B=o(this._freeDrawingXPoints),z=o(this._freeDrawingYPoints),J=this.contextTop,K=[],F,H,A=this._freeDrawingXPoints,I=this._freeDrawingYPoints;K.push("M ",A[0]-E," ",I[0]-D," ");for(var G=1;F=A[G],H=I[G];G++){K.push("L ",F-E," ",H-D," ")}K=K.join("");if(K==="M 0 0 L 0 0 "){return}var C=new fabric.Path(K);C.fill=null;C.stroke=this.freeDrawingColor;C.strokeWidth=this.freeDrawingLineWidth;this.add(C);C.set("left",E+(B-E)/2).set("top",D+(z-D)/2).setCoords();this.renderAll();y("path:created",{path:C})},__onMouseMove:function(E){if(this.isDrawingMode){if(this._isCurrentlyDrawing){this._captureDrawingPath(E)}return}var A=this._groupSelector;if(A!==null){var F=f(E);A.left=F.x-this._offset.left-A.ex;A.top=F.y-this._offset.top-A.ey;this.renderTop()}else{if(!this._currentTransform){var C=this.upperCanvasEl.style;var D=this.findTarget(E);if(!D){for(var B=this._objects.length;B--;){if(!this._objects[B].active){this._objects[B].setActive(false)}}C.cursor="default"}else{this._setCursorFromEvent(E,D);if(D.isActive()){D.setCornersVisibility&&D.setCornersVisibility(true)}}}else{var F=f(E),z=F.x,G=F.y;this._currentTransform.target.isMoving=true;if(this._currentTransform.action==="rotate"){if(!E.shiftKey){this._rotateObject(z,G)}this._scaleObject(z,G)}else{if(this._currentTransform.action==="scaleX"){this._scaleObject(z,G,"x")}else{if(this._currentTransform.action==="scaleY"){this._scaleObject(z,G,"y")}else{this._translateObject(z,G);y("object:moved",{target:this._currentTransform.target})}}}this.renderAll()}}},_translateObject:function(z,B){var A=this._currentTransform.target;A.lockMovementX||A.set("left",z-this._currentTransform.offsetX);A.lockMovementY||A.set("top",B-this._currentTransform.offsetY)},_scaleObject:function(z,G,E){var A=this._currentTransform,F=this._offset,D=A.target;if(D.lockScalingX&&D.lockScalingY){return}var C=w(c(A.ey-A.top-F.top,2)+c(A.ex-A.left-F.left,2)),B=w(c(G-A.top-F.top,2)+c(z-A.left-F.left,2));D._scaling=true;if(!E){D.lockScalingX||D.set("scaleX",A.scaleX*B/C);D.lockScalingY||D.set("scaleY",A.scaleY*B/C)}else{if(E==="x"&&!D.lockUniScaling){D.lockScalingX||D.set("scaleX",A.scaleX*B/C)}else{if(E==="y"&&!D.lockUniScaling){D.lockScalingY||D.set("scaleY",A.scaleY*B/C)}}}},_rotateObject:function(z,E){var A=this._currentTransform,C=this._offset;if(A.target.lockRotation){return}var B=b(A.ey-A.top-C.top,A.ex-A.left-C.left),D=b(E-A.top-C.top,z-A.left-C.left);A.target.set("theta",(D-B)+A.theta)},_setCursor:function(z){this.upperCanvasEl.style.cursor=z},_setCursorFromEvent:function(D,C){var A=this.upperCanvasEl.style;if(!C){A.cursor="default";return false}else{var z=this.getActiveGroup();var B=!!C._findTargetCorner&&(!z||!z.contains(C))&&C._findTargetCorner(D,this._offset);if(!B){A.cursor="move"}else{if(B in x){A.cursor=x[B]}else{A.cursor="default";return false}}}return true},_draw:function(z,A){A&&A.render(z)},_drawSelection:function(){var z=this._groupSelector,D=z.left,C=z.top,B=l(D),A=l(C);this.contextTop.fillStyle=this.selectionColor;this.contextTop.fillRect(z.ex-((D>0)?0:-D),z.ey-((C>0)?0:-C),B,A);this.contextTop.lineWidth=this.selectionLineWidth;this.contextTop.strokeStyle=this.selectionBorderColor;this.contextTop.strokeRect(z.ex+d-((D>0)?0:B),z.ey+d-((C>0)?0:A),B,A)},_findSelectedObjects:function(F){var G,B,L=[],A=this._groupSelector.ex,K=this._groupSelector.ey,z=A+this._groupSelector.left,I=K+this._groupSelector.top,H,E=new fabric.Point(p(A,z),p(K,I)),J=new fabric.Point(s(A,z),s(K,I));for(var C=0,D=this._objects.length;C<D;++C){H=this._objects[C];if(H.intersectsWithRect(E,J)||H.isContainedWithinRect(E,J)){if(H.selectable){H.setActive(true);L.push(H)}}}if(L.length===1){this.setActiveObject(L[0]);y("object:selected",{target:L[0]})}else{if(L.length>1){var L=new fabric.Group(L);this.setActiveGroup(L);L.saveCoords();y("group:selected",{target:L})}}this.renderAll()},add:function(){this._objects.push.apply(this._objects,arguments);for(var z=arguments.length;z--;){this.stateful&&arguments[z].setupState();arguments[z].setCoords()}this.renderOnAddition&&this.renderAll();return this},insertAt:function(A,z){this._objects.splice(z,0,A);this.stateful&&A.setupState();A.setCoords();this.renderAll();return this},getObjects:function(){return this._objects},getContext:function(){return this.contextTop},clearContext:function(z){z.clearRect(0,0,this.width,this.height);return this},clear:function(){this._objects.length=0;this.clearContext(this.contextTop);this.clearContext(this.contextContainer);this.renderAll();return this},renderAll:function(A){var F=this[A?"contextTop":"contextContainer"];this.clearContext(this.contextTop);if(!A){this.clearContext(F)}F.fillStyle=this.backgroundColor;F.fillRect(0,0,this.width,this.height);var E=this._objects.length,D=this.getActiveGroup(),C=new Date();if(this.clipTo){F.beginPath();this.clipTo(F);F.clip()}if(E){for(var B=0;B<E;++B){if(!D||(D&&!D.contains(this._objects[B]))){this._draw(F,this._objects[B])}}}if(D){this._draw(this.contextTop,D)}if(this.overlayImage){this.contextTop.drawImage(this.overlayImage,0,0)}if(this.onFpsUpdate){var z=new Date()-C;this.onFpsUpdate(~~(1000/z))}y("after:render");return this},renderTop:function(){this.clearContext(this.contextTop);if(this.overlayImage){this.contextTop.drawImage(this.overlayImage,0,0)}if(this._groupSelector){this._drawSelection()}var z=this.getActiveGroup();if(z){z.render(this.contextTop)}y("after:render");return this},containsPoint:function(E,D){var F=this.getPointer(E),C=this._normalizePointer(D,F),z=C.x,G=C.y;var A=D._getImageLines(D.oCoords),B=D._findCrossPoints(z,G,A);if((B&&B%2===1)||D._findTargetCorner(E,this._offset)){return true}return false},_normalizePointer:function(A,D){var C=this.getActiveGroup(),z=D.x,E=D.y;var B=(C&&A.type!=="group"&&C.contains(A));if(B){z-=C.left;E-=C.top}return{x:z,y:E}},findTarget:function(D,A){var C,E=this.getPointer(D);var B=this.getActiveGroup();if(B&&!A&&this.containsPoint(D,B)){C=B;return C}for(var z=this._objects.length;z--;){if(this.containsPoint(D,this._objects[z])){C=this._objects[z];this.relatedTarget=C;break}}if(C&&C.selectable){return C}},toDataURL:function(A){var z;if(!A){A="png"}if(A==="jpeg"||A==="png"){this.renderAll(true);z=this.upperCanvasEl.toDataURL("image/"+A);this.renderAll()}return z},toDataURLWithMultiplier:function(C,G){var F=this.getWidth(),E=this.getHeight(),A=F*G,B=E*G,z=this.getActiveObject();this.setWidth(A).setHeight(B);this.contextTop.scale(G,G);if(z){this.deactivateAll().renderAll()}var D=this.toDataURL(C);this.contextTop.scale(1/G,1/G);this.setWidth(F).setHeight(E);if(z){this.setActiveObject(z)}this.renderAll();return D},getPointer:function(z){var A=f(z);return{x:A.x-this._offset.left,y:A.y-this._offset.top}},getCenter:function(){return{top:this.getHeight()/2,left:this.getWidth()/2}},centerObjectH:function(z){z.set("left",this.getCenter().left);this.renderAll();return this},fxCenterObjectH:function(A,B){B=B||{};var C=function(){},D=B.onComplete||C,z=B.onChange||C,E=this;fabric.util.animate({startValue:A.get("left"),endValue:this.getCenter().left,duration:this.FX_DURATION,onChange:function(F){A.set("left",F);E.renderAll();z()},onComplete:function(){A.setCoords();D()}});return this},centerObjectV:function(z){z.set("top",this.getCenter().top);this.renderAll();return this},fxCenterObjectV:function(A,B){B=B||{};var C=function(){},D=B.onComplete||C,z=B.onChange||C,E=this;fabric.util.animate({startValue:A.get("top"),endValue:this.getCenter().top,duration:this.FX_DURATION,onChange:function(F){A.set("top",F);E.renderAll();z()},onComplete:function(){A.setCoords();D()}});return this},straightenObject:function(z){z.straighten();this.renderAll();return this},fxStraightenObject:function(z){z.fxStraighten({onChange:this.renderAll.bind(this)});return this},toDatalessJSON:function(){return this.toDatalessObject()},toObject:function(){return this._toObjectMethod("toObject")},toDatalessObject:function(){return this._toObjectMethod("toDatalessObject")},_toObjectMethod:function(z){return{objects:this._objects.map(function(A){if(!this.includeDefaultValues){var B=A.includeDefaultValues;A.includeDefaultValues=false}var C=A[z]();if(!this.includeDefaultValues){A.includeDefaultValues=B}return C},this),background:this.backgroundColor}},isEmpty:function(){return this._objects.length===0},loadFromJSON:function(z,C){if(!z){return}var A=JSON.parse(z);if(!A||(A&&!A.objects)){return}this.clear();var B=this;this._enlivenObjects(A.objects,function(){B.backgroundColor=A.background;if(C){C()}});return this},_enlivenObjects:function(A,D){var B=0,z=A.filter(function(E){return E.type==="image"}).length;var C=this;A.forEach(function(G,F){if(!G.type){return}switch(G.type){case"image":case"font":fabric[i(G.type)].fromObject(G,function(H){C.insertAt(H,F);if(++B===z){if(D){D()}}});break;default:var E=fabric[u(i(G.type))];if(E&&E.fromObject){C.insertAt(E.fromObject(G),F)}break}});if(z===0&&D){D()}},loadFromDatalessJSON:function(z,B){if(!z){return}var A=(typeof z==="string")?JSON.parse(z):z;if(!A||(A&&!A.objects)){return}this.clear();this.backgroundColor=A.background;this._enlivenDatalessObjects(A.objects,B)},_enlivenDatalessObjects:function(A,F){function E(H,G){D.insertAt(H,G);H.setCoords();if(++C===z){F&&F()}}var D=this,C=0,z=A.length;if(z===0&&F){F()}try{A.forEach(function(M,K){var H=M.paths?"paths":"path";var L=M[H];delete M[H];if(typeof L!=="string"){switch(M.type){case"image":case"text":fabric[i(M.type)].fromObject(M,function(N){E(N,K)});break;default:var G=fabric[u(i(M.type))];if(G&&G.fromObject){if(L){M[H]=L}E(G.fromObject(M),K)}break}}else{if(M.type==="image"){D.loadImageFromURL(L,function(N){N.setSourcePath(L);t(N,M);N.setAngle(M.angle);E(N,K)})}else{if(M.type==="text"){M.path=L;var J=fabric.Text.fromObject(M);var I=function(){if(Object.prototype.toString.call(g.opera)==="[object Opera]"){setTimeout(function(){E(J,K)},500)}else{E(J,K)}};fabric.util.getScript(L,I)}else{D.loadSVGFromURL(L,function(P,O){if(P.length>1){var N=new fabric.PathGroup(P,M)}else{var N=P[0]}N.setSourcePath(L);if(!(N instanceof fabric.PathGroup)){t(N,M);if(typeof M.angle!=="undefined"){N.setAngle(M.angle)}}E(N,K)})}}}},this)}catch(B){fabric.log(B.message)}},loadImageFromURL:(function(){var z={};return function(A,E){var D=this;function B(){var F=n.getElementById(z[A]);if(F.width&&F.height){E(new fabric.Image(F))}else{setTimeout(B,50)}}if(z[A]){B()}else{var C=new Image();C.onload=function(){C.onload=null;if(C.width&&C.height){E(new fabric.Image(C))}};C.className="canvas-img-clone";C.style.cssText="position:absolute;left:-9999px;top:-9999px;";C.src=A;if(this.shouldCacheImages){z[A]=Element.identify(C)}n.body.appendChild(C)}}})(),loadSVGFromURL:function(z,C){var B=this;z=z.replace(/^\n\s*/,"").replace(/\?.*$/,"").trim();this.cache.has(z,function(D){if(D){B.cache.get(z,function(F){var E=B._enlivenCachedObject(F);C(E.objects,E.options)})}else{new fabric.util.request(z,{method:"get",onComplete:A})}});function A(E){var D=E.responseXML;if(!D){return}var F=D.documentElement;if(!F){return}fabric.parseSVGDocument(F,function(H,G){B.cache.set(z,{objects:fabric.util.array.invoke(H,"toObject"),options:G});C(H,G)})}},_enlivenCachedObject:function(B){var A=B.objects,z=B.options;A=A.map(function(C){return fabric[i(C.type)].fromObject(C)});return({objects:A,options:z})},remove:function(z){k(this._objects,z);if(this.getActiveObject()===z){this.removeActiveObject()}this.renderAll();return z},fxRemove:function(z,B){var A=this;z.fxRemove({onChange:this.renderAll.bind(this),onComplete:function(){A.remove(z);if(typeof B==="function"){B()}}});return this},sendToBack:function(z){k(this._objects,z);this._objects.unshift(z);return this.renderAll()},bringToFront:function(z){k(this._objects,z);this._objects.push(z);return this.renderAll()},sendBackwards:function(B){var A=this._objects.indexOf(B),z=A;if(A!==0){for(var C=A-1;C>=0;--C){if(B.intersectsWithObject(this._objects[C])){z=C;break}}k(this._objects,B);this._objects.splice(z,0,B)}return this.renderAll()},bringForward:function(C){var E=this.getObjects(),A=E.indexOf(C),z=A;if(A!==E.length-1){for(var D=A+1,B=this._objects.length;D<B;++D){if(C.intersectsWithObject(E[D])){z=D;break}}k(E,C);E.splice(z,0,C)}this.renderAll()},setActiveObject:function(z){if(this._activeObject){this._activeObject.setActive(false)}this._activeObject=z;z.setActive(true);this.renderAll();y("object:selected",{target:z});return this},getActiveObject:function(){return this._activeObject},removeActiveObject:function(){if(this._activeObject){this._activeObject.setActive(false)}this._activeObject=null;return this},setActiveGroup:function(z){this._activeGroup=z;return this},getActiveGroup:function(){return this._activeGroup},removeActiveGroup:function(){var z=this.getActiveGroup();if(z){z.destroy()}return this.setActiveGroup(null)},item:function(z){return this.getObjects()[z]},deactivateAll:function(){var A=this.getObjects(),B=0,z=A.length;for(;B<z;B++){A[B].setActive(false)}this.removeActiveGroup();this.removeActiveObject();return this},complexity:function(){return this.getObjects().reduce(function(z,A){z+=A.complexity?A.complexity():0;return z},0)},forEachObject:function(C,A){var B=this.getObjects(),z=B.length;while(z--){C.call(A,B[z],z,B)}return this},dispose:function(){this.clear();e(this.upperCanvasEl,"mousedown",this._onMouseDown);e(n,"mouseup",this._onMouseUp);e(n,"mousemove",this._onMouseMove);e(g,"resize",this._onResize);return this},clone:function(B){var z=n.createElement("canvas");z.width=this.getWidth();z.height=this.getHeight();var A=this.__clone||(this.__clone=new fabric.Element(z));return A.loadFromJSON(JSON.stringify(this.toJSON()),function(){if(B){B(A)}})},_toDataURL:function(z,A){this.clone(function(B){A(B.toDataURL(z))})},_toDataURLWithMultiplier:function(z,B,A){this.clone(function(C){A(C.toDataURLWithMultiplier(z,B))})},_resizeImageToFit:function(B){var A=B.width||B.offsetWidth,z=this.getWidth()/A;if(A){B.width=A*z}},cache:{has:function(z,A){A(false)},get:function(z,A){},set:function(A,z){}}});fabric.Element.prototype.toString=function(){return"#<fabric.Element ("+this.complexity()+"): { objects: "+this.getObjects().length+" }>"};t(fabric.Element,{EMPTY_JSON:'{"objects": [], "background": "white"}',toGrayscale:function(C){var B=C.getContext("2d"),z=B.getImageData(0,0,C.width,C.height),G=z.data,D=z.width,I=z.height,H,A,F,E;for(F=0;F<D;F++){for(E=0;E<I;E++){H=(F*4)*I+(E*4);A=(G[H]+G[H+1]+G[H+2])/3;G[H]=A;G[H+1]=A;G[H+2]=A}}B.putImageData(z,0,0)},supports:function(A){var B=n.createElement("canvas");if(typeof G_vmlCanvasManager!=="undefined"){G_vmlCanvasManager.initElement(B)}if(!B||!B.getContext){return null}var z=B.getContext("2d");if(!z){return null}switch(A){case"getImageData":return typeof z.getImageData!=="undefined";case"toDataURL":return typeof B.toDataURL!=="undefined";default:return null}}});fabric.Element.prototype.toJSON=fabric.Element.prototype.toObject})(this);(function(a){var d=a.fabric||(a.fabric={}),f=d.util.object.extend,g=d.util.object.clone,c=d.util.toFixed,e=d.util.string.capitalize,i=d.util.getPointer,b=d.util.degreesToRadians,h=Array.prototype.slice;if(d.Object){return}d.Object=d.util.createClass({type:"object",includeDefaultValues:true,NUM_FRACTION_DIGITS:2,FX_DURATION:500,FX_TRANSITION:"decel",MIN_SCALE_LIMIT:0.1,stateProperties:("top left width height scaleX scaleY flipX flipY theta angle opacity cornersize fill overlayFill stroke strokeWidth fillRule borderScaleFactor transformMatrix selectable").split(" "),top:0,left:0,width:0,height:0,scaleX:1,scaleY:1,flipX:false,flipY:false,theta:0,opacity:1,angle:0,cornersize:12,padding:0,borderColor:"rgba(102,153,255,0.75)",cornerColor:"rgba(102,153,255,0.5)",fill:"rgb(0,0,0)",fillRule:"source-over",overlayFill:null,stroke:null,strokeWidth:1,borderOpacityWhenMoving:0.4,borderScaleFactor:1,transformMatrix:null,selectable:true,callSuper:function(j){var k=this.constructor.superclass.prototype[j];return(arguments.length>1)?k.apply(this,h.call(arguments,1)):k.call(this)},initialize:function(j){j&&this.setOptions(j)},setOptions:function(j){var k=this.stateProperties.length,l;while(k--){l=this.stateProperties[k];if(l in j){(l==="angle")?this.setAngle(j[l]):(this[l]=j[l])}}},transform:function(j){j.globalAlpha=this.opacity;j.translate(this.left,this.top);j.rotate(this.theta);j.scale(this.scaleX*(this.flipX?-1:1),this.scaleY*(this.flipY?-1:1))},toObject:function(){var j={type:this.type,left:c(this.left,this.NUM_FRACTION_DIGITS),top:c(this.top,this.NUM_FRACTION_DIGITS),width:c(this.width,this.NUM_FRACTION_DIGITS),height:c(this.height,this.NUM_FRACTION_DIGITS),fill:this.fill,overlayFill:this.overlayFill,stroke:this.stroke,strokeWidth:this.strokeWidth,scaleX:c(this.scaleX,this.NUM_FRACTION_DIGITS),scaleY:c(this.scaleY,this.NUM_FRACTION_DIGITS),angle:c(this.getAngle(),this.NUM_FRACTION_DIGITS),flipX:this.flipX,flipY:this.flipY,opacity:c(this.opacity,this.NUM_FRACTION_DIGITS),selectable:this.selectable};if(!this.includeDefaultValues){j=this._removeDefaultValues(j)}return j},toDatalessObject:function(){return this.toObject()},_removeDefaultValues:function(k){var j=d.Object.prototype.options;if(j){this.stateProperties.forEach(function(l){if(k[l]===j[l]){delete k[l]}})}return k},isActive:function(){return !!this.active},setActive:function(j){this.active=!!j;return this},toString:function(){return"#<fabric."+e(this.type)+">"},set:function(k,j){var l=(k==="scaleX"||k==="scaleY")&&j<this.MIN_SCALE_LIMIT;if(l){j=this.MIN_SCALE_LIMIT}if(k==="angle"){this.setAngle(j)}else{this[k]=j}return this},toggle:function(k){var j=this.get(k);if(typeof j==="boolean"){this.set(k,!j)}return this},setSourcePath:function(j){this.sourcePath=j;return this},get:function(j){return(j==="angle")?this.getAngle():this[j]},render:function(k,l){if(this.width===0||this.height===0){return}k.save();var j=this.transformMatrix;if(j){k.setTransform(j[0],j[1],j[2],j[3],j[4],j[5])}if(!l){this.transform(k)}if(this.stroke){k.lineWidth=this.strokeWidth;k.strokeStyle=this.stroke}if(this.overlayFill){k.fillStyle=this.overlayFill}else{if(this.fill){k.fillStyle=this.fill}}this._render(k,l);if(this.active&&!l){this.drawBorders(k);this.hideCorners||this.drawCorners(k)}k.restore()},getWidth:function(){return this.width*this.scaleX},getHeight:function(){return this.height*this.scaleY},scale:function(j){this.scaleX=j;this.scaleY=j;return this},scaleToWidth:function(j){return this.scale(j/this.width)},scaleToHeight:function(j){return this.scale(j/this.height)},setOpacity:function(j){this.set("opacity",j);return this},getAngle:function(){return this.theta*180/Math.PI},setAngle:function(j){this.theta=j/180*Math.PI;this.angle=j;return this},setCoords:function(){this.currentWidth=this.width*this.scaleX;this.currentHeight=this.height*this.scaleY;this._hypotenuse=Math.sqrt(Math.pow(this.currentWidth/2,2)+Math.pow(this.currentHeight/2,2));this._angle=Math.atan(this.currentHeight/this.currentWidth);var p=Math.cos(this._angle+this.theta)*this._hypotenuse,o=Math.sin(this._angle+this.theta)*this._hypotenuse,l=this.theta,s=Math.sin(l),q=Math.cos(l);var v={x:this.left-p,y:this.top-o};var r={x:v.x+(this.currentWidth*q),y:v.y+(this.currentWidth*s)};var u={x:r.x-(this.currentHeight*s),y:r.y+(this.currentHeight*q)};var m={x:v.x-(this.currentHeight*s),y:v.y+(this.currentHeight*q)};var n={x:v.x-(this.currentHeight/2*s),y:v.y+(this.currentHeight/2*q)};var j={x:v.x+(this.currentWidth/2*q),y:v.y+(this.currentWidth/2*s)};var k={x:r.x-(this.currentHeight/2*s),y:r.y+(this.currentHeight/2*q)};var t={x:m.x+(this.currentWidth/2*q),y:m.y+(this.currentWidth/2*s)};this.oCoords={tl:v,tr:r,br:u,bl:m,ml:n,mt:j,mr:k,mb:t};this._setCornerCoords();return this},drawBorders:function(k){var p=this.padding,m=p*2;k.save();k.globalAlpha=this.isMoving?this.borderOpacityWhenMoving:1;k.strokeStyle=this.borderColor;var n=1/(this.scaleX<this.MIN_SCALE_LIMIT?this.MIN_SCALE_LIMIT:this.scaleX),l=1/(this.scaleY<this.MIN_SCALE_LIMIT?this.MIN_SCALE_LIMIT:this.scaleY);k.lineWidth=1/this.borderScaleFactor;k.scale(n,l);var j=this.getWidth(),o=this.getHeight();k.strokeRect(~~(-(j/2)-p)+0.5,~~(-(o/2)-p)+0.5,~~(j+m),~~(o+m));k.restore();return this},drawCorners:function(v){var x=this.cornersize,s=x/2,r=this.padding,l=-(this.width/2),q=-(this.height/2),w,u,k=x/this.scaleX,j=x/this.scaleY,m=(r+s)/this.scaleY,n=(r+s)/this.scaleX,p=(r+s-x)/this.scaleX,o=(r+s-x)/this.scaleY,t=this.height;v.save();v.globalAlpha=this.isMoving?this.borderOpacityWhenMoving:1;v.fillStyle=this.cornerColor;w=l-n;u=q-m;v.fillRect(w,u,k,j);w=l+this.width-n;u=q-m;v.fillRect(w,u,k,j);w=l-n;u=q+t+o;v.fillRect(w,u,k,j);w=l+this.width+p;u=q+t+o;v.fillRect(w,u,k,j);w=l+this.width/2-n;u=q-m;v.fillRect(w,u,k,j);w=l+this.width/2-n;u=q+t+o;v.fillRect(w,u,k,j);w=l+this.width+p;u=q+t/2-m;v.fillRect(w,u,k,j);w=l-n;u=q+t/2-m;v.fillRect(w,u,k,j);v.restore();return this},clone:function(j){if(this.constructor.fromObject){return this.constructor.fromObject(this.toObject(),j)}return new d.Object(this.toObject())},cloneAsImage:function(l){if(d.Image){var j=new Image();j.onload=function(){if(l){l(new d.Image(j),k)}j=j.onload=null};var k={angle:this.get("angle"),flipX:this.get("flipX"),flipY:this.get("flipY")};this.set("angle",0).set("flipX",false).set("flipY",false);j.src=this.toDataURL()}return this},toDataURL:function(){var k=document.createElement("canvas");k.width=this.getWidth();k.height=this.getHeight();d.util.wrapElement(k,"div");var j=new d.Element(k);j.backgroundColor="transparent";j.renderAll();var m=this.clone();m.left=k.width/2;m.top=k.height/2;m.setActive(false);j.add(m);var l=j.toDataURL("png");j.dispose();j=m=null;return l},hasStateChanged:function(){return this.stateProperties.some(function(j){return this[j]!==this.originalState[j]},this)},saveState:function(){this.stateProperties.forEach(function(j){this.originalState[j]=this.get(j)},this);return this},setupState:function(){this.originalState={};this.saveState()},intersectsWithRect:function(l,n){var q=this.oCoords,j=new d.Point(q.tl.x,q.tl.y),m=new d.Point(q.tr.x,q.tr.y),p=new d.Point(q.bl.x,q.bl.y),k=new d.Point(q.br.x,q.br.y);var o=d.Intersection.intersectPolygonRectangle([j,m,k,p],l,n);return(o.status==="Intersection")},intersectsWithObject:function(j){function k(o){return{tl:new d.Point(o.tl.x,o.tl.y),tr:new d.Point(o.tr.x,o.tr.y),bl:new d.Point(o.bl.x,o.bl.y),br:new d.Point(o.br.x,o.br.y)}}var l=k(this.oCoords),n=k(j.oCoords);var m=d.Intersection.intersectPolygonPolygon([l.tl,l.tr,l.br,l.bl],[n.tl,n.tr,n.br,n.bl]);return(m.status==="Intersection")},isContainedWithinRect:function(l,n){var p=this.oCoords,j=new d.Point(p.tl.x,p.tl.y),m=new d.Point(p.tr.x,p.tr.y),o=new d.Point(p.bl.x,p.bl.y),k=new d.Point(p.br.x,p.br.y);return j.x>l.x&&m.x<n.x&&j.y>l.y&&o.y<n.y},isType:function(j){return this.type===j},_findTargetCorner:function(o,q){var p=i(o),n=p.x-q.left,k=p.y-q.top,m,j;for(var l in this.oCoords){j=this._getImageLines(this.oCoords[l].corner,l);m=this._findCrossPoints(n,k,j);if(m%2==1&&m!=0){this.__corner=l;return l}}return false},_findCrossPoints:function(q,p,j){var t,s,l,k,r,o,n=0,m;for(var u in j){m=j[u];if((m.o.y<p)&&(m.d.y<p)){continue}if((m.o.y>=p)&&(m.d.y>=p)){continue}if((m.o.x==m.d.x)&&(m.o.x>=q)){r=m.o.x;o=p}else{t=0;s=(m.d.y-m.o.y)/(m.d.x-m.o.x);l=p-t*q;k=m.o.y-s*m.o.x;r=-(l-k)/(t-s);o=l+t*r}if(r>=q){n+=1}if(n==2){break}}return n},_getImageLines:function(k,j){return{topline:{o:k.tl,d:k.tr},rightline:{o:k.tr,d:k.br},bottomline:{o:k.br,d:k.bl},leftline:{o:k.bl,d:k.tl}}},_setCornerCoords:function(){var n=this.oCoords,k=b(45-this.getAngle()),m=Math.sqrt(2*Math.pow(this.cornersize,2))/2,j=m*Math.cos(k),l=m*Math.sin(k);n.tl.corner={tl:{x:n.tl.x-l,y:n.tl.y-j},tr:{x:n.tl.x+j,y:n.tl.y-l},bl:{x:n.tl.x-j,y:n.tl.y+l},br:{x:n.tl.x+l,y:n.tl.y+j}};n.tr.corner={tl:{x:n.tr.x-l,y:n.tr.y-j},tr:{x:n.tr.x+j,y:n.tr.y-l},br:{x:n.tr.x+l,y:n.tr.y+j},bl:{x:n.tr.x-j,y:n.tr.y+l}};n.bl.corner={tl:{x:n.bl.x-l,y:n.bl.y-j},bl:{x:n.bl.x-j,y:n.bl.y+l},br:{x:n.bl.x+l,y:n.bl.y+j},tr:{x:n.bl.x+j,y:n.bl.y-l}};n.br.corner={tr:{x:n.br.x+j,y:n.br.y-l},bl:{x:n.br.x-j,y:n.br.y+l},br:{x:n.br.x+l,y:n.br.y+j},tl:{x:n.br.x-l,y:n.br.y-j}};n.ml.corner={tl:{x:n.ml.x-l,y:n.ml.y-j},tr:{x:n.ml.x+j,y:n.ml.y-l},bl:{x:n.ml.x-j,y:n.ml.y+l},br:{x:n.ml.x+l,y:n.ml.y+j}};n.mt.corner={tl:{x:n.mt.x-l,y:n.mt.y-j},tr:{x:n.mt.x+j,y:n.mt.y-l},bl:{x:n.mt.x-j,y:n.mt.y+l},br:{x:n.mt.x+l,y:n.mt.y+j}};n.mr.corner={tl:{x:n.mr.x-l,y:n.mr.y-j},tr:{x:n.mr.x+j,y:n.mr.y-l},bl:{x:n.mr.x-j,y:n.mr.y+l},br:{x:n.mr.x+l,y:n.mr.y+j}};n.mb.corner={tl:{x:n.mb.x-l,y:n.mb.y-j},tr:{x:n.mb.x+j,y:n.mb.y-l},bl:{x:n.mb.x-j,y:n.mb.y+l},br:{x:n.mb.x+l,y:n.mb.y+j}}},toGrayscale:function(){var j=this.get("fill");if(j){this.set("overlayFill",new d.Color(j).toGrayscale().toRgb())}return this},complexity:function(){return 0},getCenter:function(){return{x:this.get("left")+this.width/2,y:this.get("top")+this.height/2}},straighten:function(){var j=this._getAngleValueForStraighten();this.setAngle(j);return this},fxStraighten:function(k){k=k||{};var l=function(){},m=k.onComplete||l,j=k.onChange||l,n=this;d.util.animate({startValue:this.get("angle"),endValue:this._getAngleValueForStraighten(),duration:this.FX_DURATION,onChange:function(o){n.setAngle(o);j()},onComplete:function(){n.setCoords();m()},onStart:function(){n.setActive(false)}});return this},fxRemove:function(k){k||(k={});var l=function(){},m=k.onComplete||l,j=k.onChange||l,n=this;d.util.animate({startValue:this.get("opacity"),endValue:0,duration:this.FX_DURATION,onChange:function(o){n.set("opacity",o);j()},onComplete:m,onStart:function(){n.setActive(false)}});return this},_getAngleValueForStraighten:function(){var j=this.get("angle");if(j>-225&&j<=-135){return -180}else{if(j>-135&&j<=-45){return -90}else{if(j>-45&&j<=45){return 0}else{if(j>45&&j<=135){return 90}else{if(j>135&&j<=225){return 180}else{if(j>225&&j<=315){return 270}else{if(j>315){return 360}}}}}}}return 0},toJSON:function(){return this.toObject()},setGradientFill:function(j,k){this.set("fill",d.Gradient.forObject(this,j,k))}});d.Object.prototype.rotate=d.Object.prototype.setAngle})(this);(function(a){var b=a.fabric||(a.fabric={}),c=b.util.object.extend;if(b.Line){b.warn("fabric.Line is already defined");return}b.Line=b.util.createClass(b.Object,{type:"line",initialize:function(e,d){if(!e){e=[0,0,0,0]}this.callSuper("initialize",d);this.set("x1",e[0]);this.set("y1",e[1]);this.set("x2",e[2]);this.set("y2",e[3]);this.set("width",(this.x2-this.x1)||1);this.set("height",(this.y2-this.y1)||1);this.set("left",this.x1+this.width/2);this.set("top",this.y1+this.height/2)},_render:function(d){d.beginPath();d.moveTo(-this.width/2,-this.height/2);d.lineTo(this.width/2,this.height/2);var e=d.strokeStyle;d.strokeStyle=d.fillStyle;d.stroke();d.strokeStyle=e},complexity:function(){return 1},toObject:function(){return c(this.callSuper("toObject"),{x1:this.get("x1"),y1:this.get("y1"),x2:this.get("x2"),y2:this.get("y2")})}});b.Line.ATTRIBUTE_NAMES="x1 y1 x2 y2 stroke stroke-width transform".split(" ");b.Line.fromElement=function(e,d){var g=b.parseAttributes(e,b.Line.ATTRIBUTE_NAMES);var f=[g.x1||0,g.y1||0,g.x2||0,g.y2||0];return new b.Line(f,c(g,d))};b.Line.fromObject=function(d){var e=[d.x1,d.y1,d.x2,d.y2];return new b.Line(e,d)}})(this);(function(a){var b=a.fabric||(a.fabric={}),d=Math.PI*2,e=b.util.object.extend;if(b.Circle){b.warn("fabric.Circle is already defined.");return}b.Circle=b.util.createClass(b.Object,{type:"circle",initialize:function(f){f=f||{};this.set("radius",f.radius||0);this.callSuper("initialize",f);var g=this.get("radius")*2*this.get("scaleX");this.set("width",g).set("height",g)},toObject:function(){return e(this.callSuper("toObject"),{radius:this.get("radius")})},_render:function(f,g){f.beginPath();f.arc(g?this.left:0,g?this.top:0,this.radius,0,d,false);f.closePath();if(this.fill){f.fill()}if(this.stroke){f.stroke()}},getRadiusX:function(){return this.get("radius")*this.get("scaleX")},getRadiusY:function(){return this.get("radius")*this.get("scaleY")},complexity:function(){return 1}});b.Circle.ATTRIBUTE_NAMES="cx cy r fill fill-opacity stroke stroke-width transform".split(" ");b.Circle.fromElement=function(g,f){f||(f={});var h=b.parseAttributes(g,b.Circle.ATTRIBUTE_NAMES);if(!c(h)){throw Error("value of `r` attribute is required and can not be negative")}if("left" in h){h.left-=(f.width/2)||0}if("top" in h){h.top-=(f.height/2)||0}return new b.Circle(e(h,f))};function c(f){return(("radius" in f)&&(f.radius>0))}b.Circle.fromObject=function(f){return new b.Circle(f)}})(this);(function(a){var b=a.fabric||(a.fabric={});if(b.Triangle){b.warn("fabric.Triangle is already defined");return}b.Triangle=b.util.createClass(b.Object,{type:"triangle",initialize:function(c){c=c||{};this.callSuper("initialize",c);this.set("width",c.width||100).set("height",c.height||100)},_render:function(c){var d=this.width/2,e=this.height/2;c.beginPath();c.moveTo(-d,e);c.lineTo(0,-e);c.lineTo(d,e);c.closePath();if(this.fill){c.fill()}if(this.stroke){c.stroke()}},complexity:function(){return 1}});b.Triangle.fromObject=function(c){return new b.Triangle(c)}})(this);(function(a){var b=a.fabric||(a.fabric={}),c=Math.PI*2,d=b.util.object.extend;if(b.Ellipse){b.warn("fabric.Ellipse is already defined.");return}b.Ellipse=b.util.createClass(b.Object,{type:"ellipse",initialize:function(e){e=e||{};this.callSuper("initialize",e);this.set("rx",e.rx||0);this.set("ry",e.ry||0);this.set("width",this.get("rx")*2);this.set("height",this.get("ry")*2)},toObject:function(){return d(this.callSuper("toObject"),{rx:this.get("rx"),ry:this.get("ry")})},render:function(e,f){if(this.rx===0||this.ry===0){return}return this.callSuper("render",e,f)},_render:function(e,f){e.beginPath();e.save();e.transform(1,0,0,this.ry/this.rx,0,0);e.arc(f?this.left:0,f?this.top:0,this.rx,0,c,false);e.restore();if(this.stroke){e.stroke()}if(this.fill){e.fill()}},complexity:function(){return 1}});b.Ellipse.ATTRIBUTE_NAMES="cx cy rx ry fill fill-opacity stroke stroke-width transform".split(" ");b.Ellipse.fromElement=function(f,e){e||(e={});var g=b.parseAttributes(f,b.Ellipse.ATTRIBUTE_NAMES);if("left" in g){g.left-=(e.width/2)||0}if("top" in g){g.top-=(e.height/2)||0}return new b.Ellipse(d(g,e))};b.Ellipse.fromObject=function(e){return new b.Ellipse(e)}})(this);(function(b){var c=b.fabric||(b.fabric={});if(c.Rect){console.warn("fabric.Rect is already defined");return}c.Rect=c.util.createClass(c.Object,{type:"rect",options:{rx:0,ry:0},initialize:function(d){this._initStateProperties();this.callSuper("initialize",d);this._initRxRy()},_initStateProperties:function(){this.stateProperties=this.stateProperties.concat(["rx","ry"])},_initRxRy:function(){if(this.rx&&!this.ry){this.ry=this.rx}else{if(this.ry&&!this.rx){this.rx=this.ry}}},_render:function(f){var j=this.rx||0,i=this.ry||0,d=-this.width/2,k=-this.height/2,e=this.width,g=this.height;f.beginPath();f.moveTo(d+j,k);f.lineTo(d+e-j,k);f.bezierCurveTo(d+e,k,d+e,k+i,d+e,k+i);f.lineTo(d+e,k+g-i);f.bezierCurveTo(d+e,k+g,d+e-j,k+g,d+e-j,k+g);f.lineTo(d+j,k+g);f.bezierCurveTo(d,k+g,d,k+g-i,d,k+g-i);f.lineTo(d,k+i);f.bezierCurveTo(d,k,d+j,k,d+j,k);f.closePath();if(this.fill){f.fill()}if(this.stroke){f.stroke()}},_normalizeLeftTopProperties:function(d){if(d.left){this.set("left",d.left+this.getWidth()/2)}if(d.top){this.set("top",d.top+this.getHeight()/2)}return this},complexity:function(){return 1}});c.Rect.ATTRIBUTE_NAMES="x y width height rx ry fill fill-opacity stroke stroke-width transform".split(" ");function a(d){d.left=d.left||0;d.top=d.top||0;return d}c.Rect.fromElement=function(e,d){if(!e){return null}var g=c.parseAttributes(e,c.Rect.ATTRIBUTE_NAMES);g=a(g);var f=new c.Rect(c.util.object.extend((d?c.util.object.clone(d):{}),g));f._normalizeLeftTopProperties(g);return f};c.Rect.fromObject=function(d){return new c.Rect(d)}})(this);(function(a){var b=a.fabric||(a.fabric={});if(b.Polyline){b.warn("fabric.Polyline is already defined");return}b.Polyline=b.util.createClass(b.Object,{type:"polyline",initialize:function(d,c){c=c||{};this.set("points",d);this.callSuper("initialize",c);this._calcDimensions()},_calcDimensions:function(){return b.Polygon.prototype._calcDimensions.call(this)},toObject:function(){return b.Polygon.prototype.toObject.call(this)},_render:function(e){var d;e.beginPath();for(var f=0,c=this.points.length;f<c;f++){d=this.points[f];e.lineTo(d.x,d.y)}if(this.fill){e.fill()}if(this.stroke){e.stroke()}},complexity:function(){return this.get("points").length}});b.Polyline.ATTRIBUTE_NAMES="fill fill-opacity stroke stroke-width transform".split(" ");b.Polyline.fromElement=function(f,d){if(!f){return null}d||(d={});var g=b.parsePointsAttribute(f.getAttribute("points")),h=b.parseAttributes(f,b.Polyline.ATTRIBUTE_NAMES);for(var e=0,c=g.length;e<c;e++){g[e].x-=(d.width/2)||0;g[e].y-=(d.height/2)||0}return new b.Polyline(g,b.util.object.extend(h,d))};b.Polyline.fromObject=function(c){var d=c.points;return new b.Polyline(d,c)}})(this);(function(e){var f=e.fabric||(e.fabric={}),g=f.util.object.extend,d=f.util.array.min,a=f.util.array.max;if(f.Polygon){f.warn("fabric.Polygon is already defined");return}function c(h){return h.x}function b(h){return h.y}f.Polygon=f.util.createClass(f.Object,{type:"polygon",initialize:function(i,h){h=h||{};this.points=i;this.callSuper("initialize",h);this._calcDimensions()},_calcDimensions:function(){var i=this.points,h=d(i,"x"),l=d(i,"y"),k=a(i,"x"),j=a(i,"y");this.width=k-h;this.height=j-l;this.minX=h;this.minY=l},toObject:function(){return g(this.callSuper("toObject"),{points:this.points.concat()})},_render:function(k){var j;k.beginPath();for(var l=0,h=this.points.length;l<h;l++){j=this.points[l];k.lineTo(j.x,j.y)}if(this.fill){k.fill()}if(this.stroke){k.closePath();k.stroke()}},complexity:function(){return this.points.length}});f.Polygon.ATTRIBUTE_NAMES="fill fill-opacity stroke stroke-width transform".split(" ");f.Polygon.fromElement=function(l,j){if(!l){return null}j||(j={});var m=f.parsePointsAttribute(l.getAttribute("points")),n=f.parseAttributes(l,f.Polygon.ATTRIBUTE_NAMES);for(var k=0,h=m.length;k<h;k++){m[k].x-=(j.width/2)||0;m[k].y-=(j.height/2)||0}return new f.Polygon(m,g(n,j))};f.Polygon.fromObject=function(h){return new f.Polygon(h.points,h)}})(this);(function(e){var f=e.fabric||(e.fabric={}),d=f.util.array.min,a=f.util.array.max,h=f.util.object.extend,g=Object.prototype.toString;if(f.Path){f.warn("fabric.Path is already defined");return}if(!f.Object){f.warn("fabric.Path requires fabric.Object");return}function c(i){if(i[0]==="H"){return i[1]}return i[i.length-2]}function b(i){if(i[0]==="V"){return i[1]}return i[i.length-1]}f.Path=f.util.createClass(f.Object,{type:"path",initialize:function(k,j){j=j||{};this.setOptions(j);if(!k){throw Error("`path` argument is required")}var i=g.call(k)==="[object Array]";this.path=i?k:k.match&&k.match(/[a-zA-Z][^a-zA-Z]*/g);if(!this.path){return}if(!i){this._initializeFromArray(j)}if(j.sourcePath){this.setSourcePath(j.sourcePath)}},_initializeFromArray:function(j){var i="width" in j,k="height" in j;this.path=this._parsePath();if(!i||!k){h(this,this._parseDimensions());if(i){this.width=j.width}if(k){this.height=j.height}}},_render:function(v){var q,s=0,r=0,j=0,w=0,o,n,k=-(this.width/2),u=-(this.height/2);for(var m=0,p=this.path.length;m<p;++m){q=this.path[m];switch(q[0]){case"l":s+=q[1];r+=q[2];v.lineTo(s+k,r+u);break;case"L":s=q[1];r=q[2];v.lineTo(s+k,r+u);break;case"h":s+=q[1];v.lineTo(s+k,r+u);break;case"H":s=q[1];v.lineTo(s+k,r+u);break;case"v":r+=q[1];v.lineTo(s+k,r+u);break;case"V":r=q[1];v.lineTo(s+k,r+u);break;case"m":s+=q[1];r+=q[2];v.moveTo(s+k,r+u);break;case"M":s=q[1];r=q[2];v.moveTo(s+k,r+u);break;case"c":o=s+q[5];n=r+q[6];j=s+q[3];w=r+q[4];v.bezierCurveTo(s+q[1]+k,r+q[2]+u,j+k,w+u,o+k,n+u);s=o;r=n;break;case"C":s=q[5];r=q[6];j=q[3];w=q[4];v.bezierCurveTo(q[1]+k,q[2]+u,j+k,w+u,s+k,r+u);break;case"s":o=s+q[3];n=r+q[4];j=2*s-j;w=2*r-w;v.bezierCurveTo(j+k,w+u,s+q[1]+k,r+q[2]+u,o+k,n+u);s=o;r=n;break;case"S":o=q[3];n=q[4];j=2*s-j;w=2*r-w;v.bezierCurveTo(j+k,w+u,q[1]+k,q[2]+u,o+k,n+u);s=o;r=n;break;case"q":s+=q[3];r+=q[4];v.quadraticCurveTo(q[1]+k,q[2]+u,s+k,r+u);break;case"Q":s=q[3];r=q[4];j=q[1];w=q[2];v.quadraticCurveTo(j+k,w+u,s+k,r+u);break;case"T":o=s;n=r;s=q[1];r=q[2];j=-j+2*o;w=-w+2*n;v.quadraticCurveTo(j+k,w+u,s+k,r+u);break;case"a":break;case"A":break;case"z":case"Z":v.closePath();break}}},render:function(j,k){j.save();var i=this.transformMatrix;if(i){j.transform(i[0],i[1],i[2],i[3],i[4],i[5])}if(!k){this.transform(j)}if(this.overlayFill){j.fillStyle=this.overlayFill}else{if(this.fill){j.fillStyle=this.fill}}if(this.stroke){j.strokeStyle=this.stroke}j.beginPath();this._render(j);if(this.fill){j.fill()}if(this.stroke){j.strokeStyle=this.stroke;j.lineWidth=this.strokeWidth;j.lineCap=j.lineJoin="round";j.stroke()}if(!k&&this.active){this.drawBorders(j);this.hideCorners||this.drawCorners(j)}j.restore()},toString:function(){return"#<fabric.Path ("+this.complexity()+"): "+JSON.stringify({top:this.top,left:this.left})+">"},toObject:function(){var i=h(this.callSuper("toObject"),{path:this.path});if(this.sourcePath){i.sourcePath=this.sourcePath}if(this.transformMatrix){i.transformMatrix=this.transformMatrix}return i},toDatalessObject:function(){var i=this.toObject();if(this.sourcePath){i.path=this.sourcePath}delete i.sourcePath;return i},complexity:function(){return this.path.length},_parsePath:function(){var l=[],p,q;for(var o=0,m,n,k=this.path.length;o<k;o++){p=this.path[o];q=p.slice(1).trim().replace(/(\d)-/g,"$1###-").split(/\s|,|###/);m=q.length,n=[p.charAt(0)];while(m--){n[m+1]=parseFloat(q[m])}l.push(n)}return l},_parseDimensions:function(){var q=[],n=[],r,p,s=false,u,t;this.path.forEach(function(v,o){if(v[0]!=="H"){r=(o===0)?c(v):c(this.path[o-1])}if(v[0]!=="V"){p=(o===0)?b(v):b(this.path[o-1])}if(v[0]===v[0].toLowerCase()){s=true}u=s?r+c(v):v[0]==="V"?r:c(v);t=s?p+b(v):v[0]==="H"?p:b(v);var w=parseInt(u,10);if(!isNaN(w)){q.push(w)}w=parseInt(t,10);if(!isNaN(w)){n.push(w)}},this);var k=d(q),j=d(n),m=0,l=0;var i={top:j-l,left:k-m,bottom:a(n)-l,right:a(q)-m};i.width=i.right-i.left;i.height=i.bottom-i.top;return i}});f.Path.fromObject=function(i){return new f.Path(i.path,i)};f.Path.ATTRIBUTE_NAMES="d fill fill-opacity fill-rule stroke stroke-width transform".split(" ");f.Path.fromElement=function(j,i){var k=f.parseAttributes(j,f.Path.ATTRIBUTE_NAMES);return new f.Path(k.d,h(k,i))}})(this);(function(a){var d=a.fabric||(a.fabric={}),h=d.util.object.extend,f=d.util.array.invoke,i=d.Object.prototype.set,e=d.Object.prototype.toObject,b=d.util.string.camelize,g=d.util.string.capitalize;if(d.PathGroup){d.warn("fabric.PathGroup is already defined");return}d.PathGroup=d.util.createClass(d.Path,{type:"path-group",forceFillOverwrite:false,initialize:function(k,j){j=j||{};this.paths=k;this.setOptions(j);this.setCoords();if(j.sourcePath){this.setSourcePath(j.sourcePath)}},render:function(n){if(this.stub){n.save();this.transform(n);this.stub.render(n,false);if(this.active){this.drawBorders(n);this.drawCorners(n)}n.restore()}else{n.save();var j=this.transformMatrix;if(j){n.transform(j[0],j[1],j[2],j[3],j[4],j[5])}this.transform(n);for(var o=0,k=this.paths.length;o<k;++o){this.paths[o].render(n,true)}if(this.active){this.drawBorders(n);this.hideCorners||this.drawCorners(n)}n.restore()}},set:function(l,k){if((l==="fill"||l==="overlayFill")&&this.isSameColor()){this[l]=k;var j=this.paths.length;while(j--){this.paths[j].set(l,k)}}else{i.call(this,l,k)}return this},toObject:function(){return h(e.call(this),{paths:f(this.getObjects(),"clone"),sourcePath:this.sourcePath})},toDatalessObject:function(){var j=this.toObject();if(this.sourcePath){j.paths=this.sourcePath}return j},toString:function(){return"#<fabric.PathGroup ("+this.complexity()+"): { top: "+this.top+", left: "+this.left+" }>"},isSameColor:function(){var j=this.getObjects()[0].get("fill");return this.getObjects().every(function(k){return k.get("fill")===j})},complexity:function(){return this.paths.reduce(function(j,k){return j+((k&&k.complexity)?k.complexity():0)},0)},toGrayscale:function(){var j=this.paths.length;while(j--){this.paths[j].toGrayscale()}return this},getObjects:function(){return this.paths}});function c(m){for(var l=0,j=m.length;l<j;l++){if(!(m[l] instanceof d.Object)){var k=b(g(m[l].type));m[l]=d[k].fromObject(m[l])}}return m}d.PathGroup.fromObject=function(j){var k=c(j.paths);return new d.PathGroup(k,j)}})(this);(function(d){var e=d.fabric||(d.fabric={}),g=e.util.object.extend,c=e.util.array.min,a=e.util.array.max,b=e.util.array.invoke,f=e.util.removeFromArray;if(e.Group){return}e.Group=e.util.createClass(e.Object,{type:"group",initialize:function(i,h){this.objects=i||[];this.originalState={};this.callSuper("initialize");this._calcBounds();this._updateObjectsCoords();if(h){g(this,h)}this._setOpacityIfSame();this.setCoords(true);this.saveCoords();this.activateAllObjects()},_updateObjectsCoords:function(){var i=this.left,h=this.top;this.forEachObject(function(j){var k=j.get("left"),l=j.get("top");j.set("originalLeft",k);j.set("originalTop",l);j.set("left",k-i);j.set("top",l-h);j.setCoords();j.hideCorners=true},this)},toString:function(){return"#<fabric.Group: ("+this.complexity()+")>"},getObjects:function(){return this.objects},add:function(h){this._restoreObjectsState();this.objects.push(h);h.setActive(true);this._calcBounds();this._updateObjectsCoords();return this},remove:function(h){this._restoreObjectsState();f(this.objects,h);h.setActive(false);this._calcBounds();this._updateObjectsCoords();return this},size:function(){return this.getObjects().length},set:function(h,k){if(typeof k=="function"){this.set(h,k(this[h]))}else{if(h==="fill"||h==="opacity"){var j=this.objects.length;this[h]=k;while(j--){this.objects[j].set(h,k)}}else{this[h]=k}}return this},contains:function(h){return this.objects.indexOf(h)>-1},toObject:function(){return g(this.callSuper("toObject"),{objects:b(this.objects,"clone")})},render:function(j){j.save();this.transform(j);var n=Math.max(this.scaleX,this.scaleY);for(var l=0,h=this.objects.length,k;k=this.objects[l];l++){var m=k.borderScaleFactor;k.borderScaleFactor=n;k.render(j);k.borderScaleFactor=m}this.hideBorders||this.drawBorders(j);this.hideCorners||this.drawCorners(j);j.restore();this.setCoords()},item:function(h){return this.getObjects()[h]},complexity:function(){return this.getObjects().reduce(function(i,h){i+=(typeof h.complexity=="function")?h.complexity():0;return i},0)},_restoreObjectsState:function(){this.objects.forEach(this._restoreObjectState,this);return this},_restoreObjectState:function(j){var l=this.get("left"),m=this.get("top"),h=this.getAngle()*(Math.PI/180),k=j.get("originalLeft"),n=j.get("originalTop"),i=Math.cos(h)*j.get("top")+Math.sin(h)*j.get("left"),o=-Math.sin(h)*j.get("top")+Math.cos(h)*j.get("left");j.setAngle(j.getAngle()+this.getAngle());j.set("left",l+o*this.get("scaleX"));j.set("top",m+i*this.get("scaleY"));j.set("scaleX",j.get("scaleX")*this.get("scaleX"));j.set("scaleY",j.get("scaleY")*this.get("scaleY"));j.setCoords();j.hideCorners=false;j.setActive(false);j.setCoords();return this},destroy:function(){return this._restoreObjectsState()},saveCoords:function(){this._originalLeft=this.get("left");this._originalTop=this.get("top");return this},hasMoved:function(){return this._originalLeft!==this.get("left")||this._originalTop!==this.get("top")},setObjectsCoords:function(){this.forEachObject(function(h){h.setCoords()});return this},activateAllObjects:function(){return this.setActive(true)},setActive:function(h){this.forEachObject(function(i){i.setActive(h)});return this},forEachObject:e.Element.prototype.forEachObject,_setOpacityIfSame:function(){var j=this.getObjects(),i=j[0]?j[0].get("opacity"):1;var h=j.every(function(k){return k.get("opacity")===i});if(h){this.opacity=i}},_calcBounds:function(){var s=[],q=[],p,n,k,h,m,l,u,r=0,t=this.objects.length;for(;r<t;++r){m=this.objects[r];m.setCoords();for(var j in m.oCoords){s.push(m.oCoords[j].x);q.push(m.oCoords[j].y)}}p=c(s);k=a(s);n=c(q);h=a(q);l=k-p;u=h-n;this.width=l;this.height=u;this.left=p+l/2;this.top=n+u/2},containsPoint:function(i){var l=this.get("width")/2,h=this.get("height")/2,k=this.get("left"),j=this.get("top");return k-l<i.x&&k+l>i.x&&j-h<i.y&&j+h>i.y},toGrayscale:function(){var h=this.objects.length;while(h--){this.objects[h].toGrayscale()}}});e.Group.fromObject=function(h){return new e.Group(h.objects,h)}})(this);(function(a){var b=a.fabric||(a.fabric={}),d=b.util.object.extend,c=b.util.object.clone;if(b.Text){b.warn("fabric.Text is already defined");return}if(!b.Object){b.warn("fabric.Text requires fabric.Object");return}b.Text=b.util.createClass(b.Object,{fontsize:20,fontweight:100,fontfamily:"Modernist_One_400",textDecoration:"",textShadow:null,fontStyle:"",lineHeight:1.6,strokeStyle:"",strokeWidth:1,backgroundColor:"",path:null,type:"text",initialize:function(f,e){this._initStateProperties();this.text=f;this.setOptions(e);this.theta=this.angle*Math.PI/180;this.width=this.getWidth();this.setCoords()},_initStateProperties:function(){this.stateProperties=this.stateProperties.concat();this.stateProperties.push("fontfamily","fontweight","path","text","textDecoration","textShadow","fontStyle","lineHeight","strokeStyle","strokeWidth","backgroundColor");b.util.removeFromArray(this.stateProperties,"width")},toString:function(){return"#<fabric.Text ("+this.complexity()+"): "+JSON.stringify({text:this.text,fontfamily:this.fontfamily})+">"},_render:function(e){var g=Cufon.textOptions||(Cufon.textOptions={});g.left=this.left;g.top=this.top;g.context=e;g.color=this.fill;var f=this._initDummyElement();this.transform(e);Cufon.replaceElement(f,{separate:"none",fontFamily:this.fontfamily,enableTextDecoration:true,textDecoration:this.textDecoration,textShadow:this.textShadow,fontStyle:this.fontStyle,lineHeight:this.lineHeight,strokeStyle:this.strokeStyle,strokeWidth:this.strokeWidth,backgroundColor:this.backgroundColor});this.width=g.width;this.height=g.height;this.setCoords()},_initDummyElement:function(){var f=document.createElement("div"),e=document.createElement("div");e.appendChild(f);f.innerHTML=this.text;f.style.fontSize="40px";f.style.fontWeight="400";f.style.letterSpacing="normal";f.style.color="#000000";f.style.fontWeight="600";f.style.fontFamily="Verdana";return f},render:function(e){e.save();this._render(e);if(this.active){this.drawBorders(e);this.drawCorners(e)}e.restore()},toObject:function(){return d(this.callSuper("toObject"),{text:this.text,fontsize:this.fontsize,fontweight:this.fontweight,fontfamily:this.fontfamily,fontStyle:this.fontStyle,lineHeight:this.lineHeight,textDecoration:this.textDecoration,textShadow:this.textShadow,path:this.path,strokeStyle:this.strokeStyle,strokeWidth:this.strokeWidth,backgroundColor:this.backgroundColor})},setColor:function(e){this.set("fill",e);return this},setFontsize:function(e){this.set("fontsize",e);this.setCoords();return this},getText:function(){return this.text},setText:function(e){this.set("text",e);this.setCoords();return this},set:function(e,f){this[e]=f;if(e==="fontfamily"){this.path=this.path.replace(/(.*?)([^\/]*)(\.font\.js)/,"$1"+f+"$3")}return this}});b.Text.fromObject=function(e){return new b.Text(e.text,c(e))};b.Text.fromElement=function(e){}})(this);(function(a){var b=fabric.util.object.extend;if(!a.fabric){a.fabric={}}if(a.fabric.Image){fabric.warn("fabric.Image is already defined.");return}if(!fabric.Object){fabric.warn("fabric.Object is required for fabric.Image initialization");return}fabric.Image=fabric.util.createClass(fabric.Object,{maxwidth:null,maxheight:null,active:false,bordervisibility:false,cornervisibility:false,type:"image",__isGrayscaled:false,initialize:function(d,c){this.callSuper("initialize",c);this._initElement(d);this._initConfig(c||{})},getElement:function(){return this._element},setElement:function(c){this._element=c;return this},getNormalizedSize:function(d,c,e){if(e&&c&&(d.width>d.height&&(d.width/d.height)<(c/e))){normalizedWidth=~~((d.width*e)/d.height);normalizedHeight=e}else{if(e&&((d.height==d.width)||(d.height>d.width)||(d.height>e))){normalizedWidth=~~((d.width*e)/d.height);normalizedHeight=e}else{if(c&&(c<d.width)){normalizedHeight=~~((d.height*c)/d.width);normalizedWidth=c}else{normalizedWidth=d.width;normalizedHeight=d.height}}}return{width:normalizedWidth,height:normalizedHeight}},getOriginalSize:function(){var c=this.getElement();return{width:c.width,height:c.height}},setBorderVisibility:function(c){this._resetWidthHeight();this._adjustWidthHeightToBorders(showBorder);this.setCoords()},setCornersVisibility:function(c){this.cornervisibility=!!c},render:function(c,d){c.save();if(!d){this.transform(c)}this._render(c);if(this.active&&!d){this.drawBorders(c);this.hideCorners||this.drawCorners(c)}c.restore()},toObject:function(){return b(this.callSuper("toObject"),{src:this.getSrc()})},getSrc:function(){return this.getElement().src},toString:function(){return'#<fabric.Image: { src: "'+this.getSrc()+'" }>'},clone:function(c){this.constructor.fromObject(this.toObject(),c)},toGrayscale:function(g){if(this.__isGrayscaled){return}var e=this.getElement(),c=document.createElement("canvas"),d=document.createElement("img"),f=this;c.width=e.width;c.height=e.height;c.getContext("2d").drawImage(e,0,0);fabric.Element.toGrayscale(c);d.onload=function(){f.setElement(d);g&&g();d.onload=c=e=imageData=null};d.width=e.width;d.height=e.height;d.src=c.toDataURL("image/png");this.__isGrayscaled=true;return this},_render:function(d){var c=this.getOriginalSize();d.drawImage(this.getElement(),-c.width/2,-c.height/2,c.width,c.height)},_adjustWidthHeightToBorders:function(c){if(c){this.currentBorder=this.borderwidth;this.width+=(2*this.currentBorder);this.height+=(2*this.currentBorder)}else{this.currentBorder=0}},_resetWidthHeight:function(){var c=this.getElement();this.set("width",c.width);this.set("height",c.height)},_initElement:function(c){this.setElement(fabric.util.getById(c));fabric.util.addClass(this.getElement(),fabric.Image.CSS_CANVAS)},_initConfig:function(c){this.setOptions(c);this._setBorder();this._setWidthHeight(c)},_setBorder:function(){if(this.bordervisibility){this.currentBorder=this.borderwidth}else{this.currentBorder=0}},_setWidthHeight:function(c){var d=2*this.currentBorder;this.width=(this.getElement().width||0)+d;this.height=(this.getElement().height||0)+d},complexity:function(){return 1}});fabric.Image.CSS_CANVAS="canvas-img";fabric.Image.fromObject=function(d,f){var c=document.createElement("img"),e=d.src;if(d.width){c.width=d.width}if(d.height){c.height=d.height}c.onload=function(){if(f){f(new fabric.Image(c,d))}c=c.onload=null};c.src=e};fabric.Image.fromURL=function(d,f,e){var c=document.createElement("img");c.onload=function(){if(f){f(new fabric.Image(c,e))}c=c.onload=null};c.src=d};fabric.Image.ATTRIBUTE_NAMES="x y width height fill fill-opacity stroke stroke-width transform xlink:href".split(" ");fabric.Image.fromElement=function(d,f,c){c||(c={});var e=fabric.parseAttributes(d,fabric.Image.ATTRIBUTE_NAMES);fabric.Image.fromURL(e["xlink:href"],f,b(e,c))};fabric.Image.fromElement.async=true})(this);